{"version":3,"file":"ngx-mp-pose-extractor.mjs","sources":["../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.component.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.module.ts","../../../projects/ngx-mp-pose-extractor/src/lib/services/pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/public-api.ts","../../../projects/ngx-mp-pose-extractor/src/ngx-mp-pose-extractor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgxMpPoseExtractorService {\n\n  constructor() { }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'lib-ngx-mp-pose-extractor',\n  template: `\n    <p>\n      ngx-mp-pose-extractor works!\n    </p>\n  `,\n  styles: [\n  ]\n})\nexport class NgxMpPoseExtractorComponent {\n\n}\n","import { NgModule } from '@angular/core';\nimport { NgxMpPoseExtractorComponent } from './ngx-mp-pose-extractor.component';\n\n@NgModule({\n  declarations: [NgxMpPoseExtractorComponent],\n  imports: [],\n  exports: [NgxMpPoseExtractorComponent],\n})\nexport class NgxMpPoseExtractorModule {}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport {\n  HAND_CONNECTIONS,\n  Holistic,\n  NormalizedLandmark,\n  NormalizedLandmarkList,\n  POSE_CONNECTIONS,\n  POSE_LANDMARKS,\n  POSE_LANDMARKS_LEFT,\n  POSE_LANDMARKS_RIGHT,\n  Results,\n} from '@mediapipe/holistic';\nimport { drawConnectors, drawLandmarks, lerp } from '@mediapipe/drawing_utils';\n\n/**\n * MediaPipe を用いて動画からポーズを抽出するためのサービス\n *\n * ※ シングルトンなサービスではないため、Component で providers に指定して使用することを想定\n */\n@Injectable()\nexport class PoseExtractorService {\n  public onResultsEventEmitter: EventEmitter<{\n    mpResults: Results;\n    posePreviewImageDataUrl: string;\n  }> = new EventEmitter();\n\n  private holistic?: Holistic;\n\n  private posePreviewCanvasElement?: HTMLCanvasElement;\n  private posePreviewCanvasContext?: CanvasRenderingContext2D;\n\n  private handPreviewCanvasElement?: HTMLCanvasElement;\n  private handPreviewCanvasContext?: CanvasRenderingContext2D;\n\n  constructor() {\n    this.init();\n  }\n\n  public getPosePreviewMediaStream(): MediaStream | undefined {\n    if (!this.posePreviewCanvasElement) return;\n    return this.posePreviewCanvasElement.captureStream();\n  }\n\n  public getHandPreviewMediaStream(): MediaStream | undefined {\n    if (!this.handPreviewCanvasElement) return;\n    return this.handPreviewCanvasElement.captureStream();\n  }\n\n  public async onVideoFrame(videoElement: HTMLVideoElement) {\n    if (!this.holistic) return;\n\n    if (this.posePreviewCanvasElement) {\n      this.posePreviewCanvasElement.width = videoElement.videoWidth;\n      this.posePreviewCanvasElement.height = videoElement.videoHeight;\n    }\n\n    if (this.handPreviewCanvasElement) {\n      this.handPreviewCanvasElement.width = videoElement.videoWidth;\n      this.handPreviewCanvasElement.height = videoElement.videoHeight;\n    }\n\n    await this.holistic.send({ image: videoElement });\n  }\n\n  private init() {\n    this.posePreviewCanvasElement = document.createElement('canvas');\n    this.posePreviewCanvasContext =\n      this.posePreviewCanvasElement.getContext('2d') || undefined;\n\n    this.handPreviewCanvasElement = document.createElement('canvas');\n    this.handPreviewCanvasContext =\n      this.handPreviewCanvasElement.getContext('2d') || undefined;\n\n    this.holistic = new Holistic({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;\n      },\n    });\n\n    this.holistic.setOptions({\n      selfieMode: false,\n      modelComplexity: 1,\n      smoothLandmarks: true,\n      enableSegmentation: false,\n      smoothSegmentation: true,\n      minDetectionConfidence: 0.6,\n      minTrackingConfidence: 0.6,\n    });\n\n    this.holistic.onResults((results: Results) => {\n      this.onResults(results);\n    });\n  }\n\n  private onResults(results: Results) {\n    if (\n      !this.posePreviewCanvasElement ||\n      !this.posePreviewCanvasContext ||\n      !this.holistic\n    )\n      return;\n\n    // 描画用に不必要なランドマークを除去\n    let poseLandmarks: NormalizedLandmarkList = [];\n    if (results.poseLandmarks) {\n      poseLandmarks = JSON.parse(\n        JSON.stringify(results.poseLandmarks)\n      ) as NormalizedLandmarkList;\n      this.removeElements(\n        poseLandmarks,\n        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 16, 17, 18, 19, 20, 21, 22]\n      );\n    }\n\n    // キャンバスを塗りつぶし\n    this.posePreviewCanvasContext.save();\n    this.posePreviewCanvasContext.clearRect(\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 検出に使用したフレーム画像を描画\n    this.posePreviewCanvasContext.drawImage(\n      results.image,\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 肘と手をつなぐ線を描画\n    this.posePreviewCanvasContext.lineWidth = 5;\n    if (poseLandmarks) {\n      if (results.rightHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW],\n            results.rightHandLandmarks[0],\n          ],\n        ]);\n      }\n      if (results.leftHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW],\n            results.leftHandLandmarks[0],\n          ],\n        ]);\n      }\n    }\n\n    // ポーズのプレビューを描画\n    if (poseLandmarks) {\n      drawConnectors(\n        this.posePreviewCanvasContext,\n        poseLandmarks,\n        POSE_CONNECTIONS,\n        { color: 'white' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_LEFT).map((index) => poseLandmarks[index]),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(255,138,0)' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_RIGHT).map(\n          (index) => poseLandmarks[index]\n        ),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(0,217,231)' }\n      );\n    }\n\n    // 手のプレビューを描画\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.rightHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.rightHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(0,217,231)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.leftHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.leftHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(255,138,0)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n\n    // 手の領域のみのプレビューを生成\n    if (this.handPreviewCanvasContext && this.handPreviewCanvasElement) {\n      const HAND_PREVIEW_ZOOM = 3;\n      const handPreviewBaseY = this.handPreviewCanvasElement.height / 2;\n\n      this.handPreviewCanvasContext.clearRect(\n        0,\n        0,\n        this.handPreviewCanvasElement.width,\n        this.handPreviewCanvasElement.height\n      );\n\n      if (results.rightHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.rightHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX = 0;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n\n      if (results.leftHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.leftHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX =\n          this.handPreviewCanvasElement.width - rect[2] * HAND_PREVIEW_ZOOM;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n    }\n\n    // イベントを送出\n    this.onResultsEventEmitter.emit({\n      mpResults: results,\n      posePreviewImageDataUrl:\n        this.posePreviewCanvasElement.toDataURL('image/jpeg'),\n    });\n\n    // 完了\n    this.posePreviewCanvasContext.restore();\n  }\n\n  private connect(\n    ctx: CanvasRenderingContext2D,\n    connectors: Array<[NormalizedLandmark, NormalizedLandmark]>\n  ) {\n    const canvas = ctx.canvas;\n    for (const connector of connectors) {\n      const from = connector[0];\n      const to = connector[1];\n      if (from && to) {\n        if (\n          from.visibility &&\n          to.visibility &&\n          (from.visibility < 0.1 || to.visibility < 0.1)\n        ) {\n          continue;\n        }\n        ctx.beginPath();\n        ctx.moveTo(from.x * canvas.width, from.y * canvas.height);\n        ctx.lineTo(to.x * canvas.width, to.y * canvas.height);\n        ctx.stroke();\n      }\n    }\n  }\n\n  private removeElements(\n    landmarks: NormalizedLandmarkList,\n    elements: number[]\n  ) {\n    for (const element of elements) {\n      delete landmarks[element];\n    }\n  }\n\n  private getRectByLandmarks(landmarks: any[], width: number, height: number) {\n    const leftHandLandmarksX = landmarks.map((landmark) => landmark.x * width);\n    const leftHandLandmarksY = landmarks.map((landmark) => landmark.y * height);\n    const minX = Math.min(...leftHandLandmarksX);\n    const maxX = Math.max(...leftHandLandmarksX);\n    const minY = Math.min(...leftHandLandmarksY);\n    const maxY = Math.max(...leftHandLandmarksY);\n    return [minX, minY, maxX - minX, maxY - minY];\n  }\n}\n","/*\n * Public API Surface of ngx-mp-pose-extractor\n */\n\nexport * from './lib/ngx-mp-pose-extractor.service';\nexport * from './lib/ngx-mp-pose-extractor.component';\nexport * from './lib/ngx-mp-pose-extractor.module';\n\nexport * from './lib/interfaces/pose-vector';\nexport * from './lib/interfaces/pose-item';\nexport * from './lib/interfaces/pose-json-item';\nexport * from './lib/interfaces/pose-json';\n\nexport * from './lib/services/pose-extractor.service';\nexport * from './lib/services/pose-extractor.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;MAKa,yBAAyB,CAAA;AAEpC,IAAA,WAAA,GAAA,GAAiB;;sHAFN,yBAAyB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAzB,yBAAA,CAAA,KAAA,GAAA,EAAA,CAAA,qBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,yBAAyB,cAFxB,MAAM,EAAA,CAAA,CAAA;2FAEP,yBAAyB,EAAA,UAAA,EAAA,CAAA;kBAHrC,UAAU;AAAC,YAAA,IAAA,EAAA,CAAA;AACV,oBAAA,UAAU,EAAE,MAAM;iBACnB,CAAA;;;MCQY,2BAA2B,CAAA;;wHAA3B,2BAA2B,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAA3B,2BAAA,CAAA,IAAA,GAAA,EAAA,CAAA,oBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA,2BAA2B,EAR5B,QAAA,EAAA,2BAAA,EAAA,QAAA,EAAA,EAAA,EAAA,QAAA,EAAA,CAAA;;;;AAIT,EAAA,CAAA,EAAA,QAAA,EAAA,IAAA,EAAA,CAAA,CAAA;2FAIU,2BAA2B,EAAA,UAAA,EAAA,CAAA;kBAVvC,SAAS;YACE,IAAA,EAAA,CAAA,EAAA,QAAA,EAAA,2BAA2B,EAC3B,QAAA,EAAA,CAAA;;;;AAIT,EAAA,CAAA,EAAA,CAAA;;;MCAU,wBAAwB,CAAA;;qHAAxB,wBAAwB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,QAAA,EAAA,CAAA,CAAA;sHAAxB,wBAAwB,EAAA,YAAA,EAAA,CAJpB,2BAA2B,CAAA,EAAA,OAAA,EAAA,CAEhC,2BAA2B,CAAA,EAAA,CAAA,CAAA;sHAE1B,wBAAwB,EAAA,CAAA,CAAA;2FAAxB,wBAAwB,EAAA,UAAA,EAAA,CAAA;kBALpC,QAAQ;AAAC,YAAA,IAAA,EAAA,CAAA;oBACR,YAAY,EAAE,CAAC,2BAA2B,CAAC;AAC3C,oBAAA,OAAO,EAAE,EAAE;oBACX,OAAO,EAAE,CAAC,2BAA2B,CAAC;iBACvC,CAAA;;;ACOD;;;;AAIG;MAEU,oBAAoB,CAAA;AAc/B,IAAA,WAAA,GAAA;AAbO,QAAA,IAAA,CAAA,qBAAqB,GAGvB,IAAI,YAAY,EAAE,CAAC;QAWtB,IAAI,CAAC,IAAI,EAAE,CAAC;KACb;IAEM,yBAAyB,GAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,wBAAwB;YAAE,OAAO;AAC3C,QAAA,OAAO,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,CAAC;KACtD;IAEM,yBAAyB,GAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,wBAAwB;YAAE,OAAO;AAC3C,QAAA,OAAO,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,CAAC;KACtD;AAEY,IAAA,YAAY,CAAC,YAA8B,EAAA;;YACtD,IAAI,CAAC,IAAI,CAAC,QAAQ;gBAAE,OAAO;YAE3B,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,YAAY,CAAC,UAAU,CAAC;gBAC9D,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,YAAY,CAAC,WAAW,CAAC;AACjE,aAAA;YAED,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,YAAY,CAAC,UAAU,CAAC;gBAC9D,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,YAAY,CAAC,WAAW,CAAC;AACjE,aAAA;AAED,YAAA,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,CAAC,CAAC;SACnD,CAAA,CAAA;AAAA,KAAA;IAEO,IAAI,GAAA;QACV,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,wBAAwB;YAC3B,IAAI,CAAC,wBAAwB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;QAE9D,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,wBAAwB;YAC3B,IAAI,CAAC,wBAAwB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;AAE9D,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAAC;AAC3B,YAAA,UAAU,EAAE,CAAC,IAAI,KAAI;gBACnB,OAAO,CAAA,iDAAA,EAAoD,IAAI,CAAA,CAAE,CAAC;aACnE;AACF,SAAA,CAAC,CAAC;AAEH,QAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;AACvB,YAAA,UAAU,EAAE,KAAK;AACjB,YAAA,eAAe,EAAE,CAAC;AAClB,YAAA,eAAe,EAAE,IAAI;AACrB,YAAA,kBAAkB,EAAE,KAAK;AACzB,YAAA,kBAAkB,EAAE,IAAI;AACxB,YAAA,sBAAsB,EAAE,GAAG;AAC3B,YAAA,qBAAqB,EAAE,GAAG;AAC3B,SAAA,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,OAAgB,KAAI;AAC3C,YAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AAC1B,SAAC,CAAC,CAAC;KACJ;AAEO,IAAA,SAAS,CAAC,OAAgB,EAAA;QAChC,IACE,CAAC,IAAI,CAAC,wBAAwB;YAC9B,CAAC,IAAI,CAAC,wBAAwB;YAC9B,CAAC,IAAI,CAAC,QAAQ;YAEd,OAAO;;QAGT,IAAI,aAAa,GAA2B,EAAE,CAAC;QAC/C,IAAI,OAAO,CAAC,aAAa,EAAE;AACzB,YAAA,aAAa,GAAG,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,aAAa,CAAC,CACZ,CAAC;YAC5B,IAAI,CAAC,cAAc,CACjB,aAAa,EACb,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CACnE,CAAC;AACH,SAAA;;AAGD,QAAA,IAAI,CAAC,wBAAwB,CAAC,IAAI,EAAE,CAAC;QACrC,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;;QAGF,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,OAAO,CAAC,KAAK,EACb,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;;AAGF,QAAA,IAAI,CAAC,wBAAwB,CAAC,SAAS,GAAG,CAAC,CAAC;AAC5C,QAAA,IAAI,aAAa,EAAE;YACjB,IAAI,OAAO,CAAC,kBAAkB,EAAE;AAC9B,gBAAA,IAAI,CAAC,wBAAwB,CAAC,WAAW,GAAG,OAAO,CAAC;AACpD,gBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,wBAAwB,EAAE;AAC1C,oBAAA;AACE,wBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC;AACzC,wBAAA,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;AAC9B,qBAAA;AACF,iBAAA,CAAC,CAAC;AACJ,aAAA;YACD,IAAI,OAAO,CAAC,iBAAiB,EAAE;AAC7B,gBAAA,IAAI,CAAC,wBAAwB,CAAC,WAAW,GAAG,OAAO,CAAC;AACpD,gBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,wBAAwB,EAAE;AAC1C,oBAAA;AACE,wBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC;AACxC,wBAAA,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAC;AAC7B,qBAAA;AACF,iBAAA,CAAC,CAAC;AACJ,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,aAAa,EAAE;AACjB,YAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,aAAa,EACb,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;AACF,YAAA,aAAa,CACX,IAAI,CAAC,wBAAwB,EAC7B,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,aAAa,CAAC,KAAK,CAAC,CAAC,EACvE,EAAE,aAAa,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,gBAAgB,EAAE,CACrE,CAAC;AACF,YAAA,aAAa,CACX,IAAI,CAAC,wBAAwB,EAC7B,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,GAAG,CACrC,CAAC,KAAK,KAAK,aAAa,CAAC,KAAK,CAAC,CAChC,EACD,EAAE,aAAa,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,gBAAgB,EAAE,CACrE,CAAC;AACH,SAAA;;AAGD,QAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,OAAO,CAAC,kBAAkB,EAC1B,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;QACF,aAAa,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,kBAAkB,EAAE;AACvE,YAAA,KAAK,EAAE,OAAO;AACd,YAAA,SAAS,EAAE,gBAAgB;AAC3B,YAAA,SAAS,EAAE,CAAC;AACZ,YAAA,MAAM,EAAE,CAAC,IAAS,KAAI;AACpB,gBAAA,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;aAC7C;AACF,SAAA,CAAC,CAAC;AACH,QAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,OAAO,CAAC,iBAAiB,EACzB,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;QACF,aAAa,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,iBAAiB,EAAE;AACtE,YAAA,KAAK,EAAE,OAAO;AACd,YAAA,SAAS,EAAE,gBAAgB;AAC3B,YAAA,SAAS,EAAE,CAAC;AACZ,YAAA,MAAM,EAAE,CAAC,IAAS,KAAI;AACpB,gBAAA,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;aAC7C;AACF,SAAA,CAAC,CAAC;;AAGH,QAAA,IAAI,IAAI,CAAC,wBAAwB,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAClE,MAAM,iBAAiB,GAAG,CAAC,CAAC;YAC5B,MAAM,gBAAgB,GAAG,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,CAAC,CAAC;YAElE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;YAEF,IAAI,OAAO,CAAC,kBAAkB,EAAE;gBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAClC,OAAO,CAAC,kBAAkB,EAC1B,OAAO,CAAC,KAAK,CAAC,KAAK,EACnB,OAAO,CAAC,KAAK,CAAC,MAAM,CACrB,CAAC;gBAEF,IAAI,YAAY,GAAG,CAAC,CAAC;AACrB,gBAAA,IAAI,YAAY,GAAG,gBAAgB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,IAAI,CAAC,CAAC;gBAExE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,YAAY,EACZ,YAAY,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,EAC3B,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAC5B,CAAC;AACH,aAAA;YAED,IAAI,OAAO,CAAC,iBAAiB,EAAE;gBAC7B,MAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAClC,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,KAAK,CAAC,KAAK,EACnB,OAAO,CAAC,KAAK,CAAC,MAAM,CACrB,CAAC;AAEF,gBAAA,IAAI,YAAY,GACd,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC;AACpE,gBAAA,IAAI,YAAY,GAAG,gBAAgB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,IAAI,CAAC,CAAC;gBAExE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,YAAY,EACZ,YAAY,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,EAC3B,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAC5B,CAAC;AACH,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC;AAC9B,YAAA,SAAS,EAAE,OAAO;YAClB,uBAAuB,EACrB,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,YAAY,CAAC;AACxD,SAAA,CAAC,CAAC;;AAGH,QAAA,IAAI,CAAC,wBAAwB,CAAC,OAAO,EAAE,CAAC;KACzC;IAEO,OAAO,CACb,GAA6B,EAC7B,UAA2D,EAAA;AAE3D,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;AAC1B,QAAA,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;AAClC,YAAA,MAAM,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;AAC1B,YAAA,MAAM,EAAE,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YACxB,IAAI,IAAI,IAAI,EAAE,EAAE;gBACd,IACE,IAAI,CAAC,UAAU;AACf,oBAAA,EAAE,CAAC,UAAU;AACb,qBAAC,IAAI,CAAC,UAAU,GAAG,GAAG,IAAI,EAAE,CAAC,UAAU,GAAG,GAAG,CAAC,EAC9C;oBACA,SAAS;AACV,iBAAA;gBACD,GAAG,CAAC,SAAS,EAAE,CAAC;AAChB,gBAAA,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;AAC1D,gBAAA,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;gBACtD,GAAG,CAAC,MAAM,EAAE,CAAC;AACd,aAAA;AACF,SAAA;KACF;IAEO,cAAc,CACpB,SAAiC,EACjC,QAAkB,EAAA;AAElB,QAAA,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE;AAC9B,YAAA,OAAO,SAAS,CAAC,OAAO,CAAC,CAAC;AAC3B,SAAA;KACF;AAEO,IAAA,kBAAkB,CAAC,SAAgB,EAAE,KAAa,EAAE,MAAc,EAAA;AACxE,QAAA,MAAM,kBAAkB,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;AAC3E,QAAA,MAAM,kBAAkB,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;QAC5E,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;AAC7C,QAAA,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,GAAG,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,CAAC;KAC/C;;iHA3SU,oBAAoB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;qHAApB,oBAAoB,EAAA,CAAA,CAAA;2FAApB,oBAAoB,EAAA,UAAA,EAAA,CAAA;kBADhC,UAAU;;;ACnBX;;AAEG;;ACFH;;AAEG;;;;"}