{"version":3,"file":"ngx-mp-pose-extractor.mjs","sources":["../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.component.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.module.ts","../../../projects/ngx-mp-pose-extractor/src/lib/classes/pose.ts","../../../projects/ngx-mp-pose-extractor/src/lib/services/pose-composer.service.ts","../../../projects/ngx-mp-pose-extractor/src/lib/services/pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/public-api.ts","../../../projects/ngx-mp-pose-extractor/src/ngx-mp-pose-extractor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgxMpPoseExtractorService {\n\n  constructor() { }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'lib-ngx-mp-pose-extractor',\n  template: `\n    <p>\n      ngx-mp-pose-extractor works!\n    </p>\n  `,\n  styles: [\n  ]\n})\nexport class NgxMpPoseExtractorComponent {\n\n}\n","import { NgModule } from '@angular/core';\nimport { NgxMpPoseExtractorComponent } from './ngx-mp-pose-extractor.component';\n\n@NgModule({\n  declarations: [NgxMpPoseExtractorComponent],\n  imports: [],\n  exports: [NgxMpPoseExtractorComponent],\n})\nexport class NgxMpPoseExtractorModule {}\n","import { POSE_LANDMARKS, Results } from '@mediapipe/holistic';\nimport * as JSZip from 'jszip';\nimport { PoseItem } from '../interfaces/pose-item';\nimport { PoseJson } from '../interfaces/pose-json';\nimport { PoseJsonItem } from '../interfaces/pose-json-item';\nimport { PoseVector } from '../interfaces/pose-vector';\n\n// @ts-ignore\nimport cosSimilarity from 'cos-similarity';\n\nexport class Pose {\n  public generator?: string;\n  public version?: number;\n  private videoMetadata!: {\n    name: string;\n    width: number;\n    height: number;\n    duration: number;\n  };\n  public poses: PoseItem[] = [];\n  public isFinalized?: boolean = false;\n\n  public static readonly IS_ENABLE_DUPLICATED_POSE_REDUCTION = true;\n\n  public static readonly IS_SHRINK_RAW_POSE_DATA = false;\n\n  public static readonly POSE_VECTOR_MAPPINGS = [\n    'rightWristToRightElbow',\n    'rightElbowToRightShoulder',\n    'leftWristToLeftElbow',\n    'leftElbowToLeftShoulder',\n  ];\n\n  constructor() {\n    this.videoMetadata = {\n      name: '',\n      width: 0,\n      height: 0,\n      duration: 0,\n    };\n  }\n\n  getVideoName() {\n    return this.videoMetadata.name;\n  }\n\n  setVideoName(videoName: string) {\n    this.videoMetadata.name = videoName;\n  }\n\n  setVideoMetaData(width: number, height: number, duration: number) {\n    this.videoMetadata.width = width;\n    this.videoMetadata.height = height;\n    this.videoMetadata.duration = duration;\n  }\n\n  getNumberOfPoses(): number {\n    if (this.poses === undefined) return -1;\n    return this.poses.length;\n  }\n\n  getPoses(): PoseItem[] {\n    if (this.poses === undefined) return [];\n    return this.poses;\n  }\n\n  pushPose(\n    videoTimeMiliseconds: number,\n    frameImageJpegDataUrl: string | undefined,\n    videoWidth: number,\n    videoHeight: number,\n    videoDuration: number,\n    results: Results\n  ) {\n    this.setVideoMetaData(videoWidth, videoHeight, videoDuration);\n\n    if (results.poseLandmarks === undefined) return;\n\n    const poseLandmarksWithWorldCoordinate: any[] = (results as any).ea\n      ? (results as any).ea\n      : [];\n    if (poseLandmarksWithWorldCoordinate.length === 0) {\n      console.warn(\n        `[Pose] pushPose - Could not get the pose with the world coordinate`,\n        results\n      );\n      return;\n    }\n\n    const poseVector = Pose.getPoseVector(poseLandmarksWithWorldCoordinate);\n    if (!poseVector) {\n      console.warn(\n        `[Pose] pushPose - Could not get the pose vector`,\n        poseLandmarksWithWorldCoordinate\n      );\n      return;\n    }\n\n    const pose: PoseItem = {\n      t: videoTimeMiliseconds,\n      pose: poseLandmarksWithWorldCoordinate.map((landmark) => {\n        return [landmark.x, landmark.y, landmark.z, landmark.visibility];\n      }),\n      vectors: poseVector,\n      frameImageDataUrl: frameImageJpegDataUrl,\n    };\n\n    if (1 <= this.poses.length) {\n      const lastPose = this.poses[this.poses.length - 1];\n      if (Pose.isSimilarPose(lastPose.vectors, pose.vectors)) {\n        return;\n      }\n    }\n\n    this.poses.push(pose);\n  }\n\n  finalize() {\n    if (Pose.IS_ENABLE_DUPLICATED_POSE_REDUCTION) {\n      // 全ポーズを走査して、類似するポーズを削除する\n      const newPoses: PoseItem[] = [];\n      for (const poseA of this.poses) {\n        let isDuplicated = false;\n        for (const poseB of newPoses) {\n          if (Pose.isSimilarPose(poseA.vectors, poseB.vectors)) {\n            isDuplicated = true;\n            break;\n          }\n        }\n        if (isDuplicated) continue;\n\n        newPoses.push(poseA);\n      }\n\n      console.info(\n        `[Pose] getJson - Reduced ${this.poses.length} poses -> ${newPoses.length} poses`\n      );\n      this.poses = newPoses;\n    }\n\n    this.isFinalized = true;\n  }\n\n  getSimilarPoses(results: Results): PoseItem[] {\n    const poseVector = Pose.getPoseVector((results as any).ea);\n    if (!poseVector) throw 'Could not get the pose vector';\n\n    return this.poses.filter((p) => Pose.isSimilarPose(p.vectors, poseVector));\n  }\n\n  static getPoseVector(\n    poseLandmarks: { x: number; y: number; z: number }[]\n  ): PoseVector | undefined {\n    return {\n      rightWristToRightElbow: [\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].x -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].x,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].y -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].y,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].z -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].z,\n      ],\n      rightElbowToRightShoulder: [\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].x -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].x,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].y -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].y,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].z -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].z,\n      ],\n      leftWristToLeftElbow: [\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].x -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].x,\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].y -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].y,\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].z -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].z,\n      ],\n      leftElbowToLeftShoulder: [\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].x -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].x,\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].y -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].y,\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].z -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].z,\n      ],\n    };\n  }\n\n  static isSimilarPose(\n    poseVectorA: PoseVector,\n    poseVectorB: PoseVector,\n    threshold = 0.9\n  ): boolean {\n    const cosSimilarities = {\n      leftWristToLeftElbow: cosSimilarity(\n        poseVectorA.leftWristToLeftElbow,\n        poseVectorB.leftWristToLeftElbow\n      ),\n      leftElbowToLeftShoulder: cosSimilarity(\n        poseVectorA.leftElbowToLeftShoulder,\n        poseVectorB.leftElbowToLeftShoulder\n      ),\n      rightWristToRightElbow: cosSimilarity(\n        poseVectorA.rightWristToRightElbow,\n        poseVectorB.rightWristToRightElbow\n      ),\n      rightElbowToRightShoulder: cosSimilarity(\n        poseVectorA.rightElbowToRightShoulder,\n        poseVectorB.rightElbowToRightShoulder\n      ),\n    };\n\n    let isSimilar = false;\n    const cosSimilaritiesSum = Object.values(cosSimilarities).reduce(\n      (sum, value) => sum + value,\n      0\n    );\n    if (cosSimilaritiesSum >= threshold * Object.keys(cosSimilarities).length)\n      isSimilar = true;\n\n    console.log(`[Pose] isSimilarPose`, isSimilar, cosSimilarities);\n\n    return isSimilar;\n  }\n\n  public async getZip(): Promise<Blob> {\n    const jsZip = new JSZip();\n    jsZip.file('poses.json', this.getJson());\n\n    for (const pose of this.poses) {\n      if (!pose.frameImageDataUrl) continue;\n      try {\n        const index =\n          pose.frameImageDataUrl.indexOf('base64,') + 'base64,'.length;\n        const base64 = pose.frameImageDataUrl.substring(index);\n\n        jsZip.file(`snapshot-${pose.t}.jpg`, base64, { base64: true });\n      } catch (error) {\n        console.warn(\n          `[PoseExporterService] push - Could not push frame image`,\n          error\n        );\n        throw error;\n      }\n    }\n\n    return await jsZip.generateAsync({ type: 'blob' });\n  }\n\n  public getJson(): string {\n    if (this.videoMetadata === undefined || this.poses === undefined)\n      return '{}';\n\n    if (!this.isFinalized) {\n      this.finalize();\n    }\n\n    let poseLandmarkMappings = [];\n    for (const key of Object.keys(POSE_LANDMARKS)) {\n      const index: number = POSE_LANDMARKS[key as keyof typeof POSE_LANDMARKS];\n      poseLandmarkMappings[index] = key;\n    }\n\n    const json: PoseJson = {\n      generator: 'mp-video-pose-extractor',\n      version: 1,\n      video: this.videoMetadata!,\n      poses: this.poses.map((pose: PoseItem): PoseJsonItem => {\n        const poseVector = [];\n        for (const key of Pose.POSE_VECTOR_MAPPINGS) {\n          poseVector.push(pose.vectors[key as keyof PoseVector]);\n        }\n\n        return {\n          t: pose.t,\n          pose: Pose.IS_SHRINK_RAW_POSE_DATA ? [] : pose.pose,\n          vectors: poseVector,\n        };\n      }),\n      poseLandmarkMapppings: Pose.IS_SHRINK_RAW_POSE_DATA\n        ? []\n        : poseLandmarkMappings,\n    };\n\n    return JSON.stringify(json);\n  }\n\n  loadJson(json: string) {\n    const parsedJson = JSON.parse(json);\n\n    if (parsedJson.generator !== 'mp-video-pose-extractor') {\n      throw '不正なファイル';\n    } else if (parsedJson.version !== 1) {\n      throw '未対応のバージョン';\n    }\n\n    this.videoMetadata = parsedJson.video;\n    this.poses = parsedJson.poses.map(\n      (poseJsonItem: PoseJsonItem): PoseItem => {\n        const poseVector: any = {};\n        Pose.POSE_VECTOR_MAPPINGS.map((key, index) => {\n          poseVector[key as keyof PoseVector] = poseJsonItem.vectors[index];\n        });\n\n        return {\n          t: poseJsonItem.t,\n          pose: poseJsonItem.pose,\n          vectors: poseVector,\n          frameImageDataUrl: undefined,\n        };\n      }\n    );\n  }\n\n  async loadZip(buffer: ArrayBuffer, includeImages: boolean = true) {\n    const jsZip = new JSZip();\n    const zip = await jsZip.loadAsync(buffer, { base64: false });\n    if (!zip) throw 'ZIPファイルを読み込めませんでした';\n\n    const json = await zip.file('poses.json')?.async('text');\n    if (json === undefined) {\n      throw 'ZIPファイルに pose.json が含まれていません';\n    }\n\n    this.loadJson(json);\n\n    if (includeImages) {\n      for (const pose of this.poses) {\n        const frameImageFileName = `snapshot-${pose.t}.jpg`;\n        const imageBase64 = await zip.file(frameImageFileName)?.async('base64');\n        if (imageBase64 === undefined && !pose.frameImageDataUrl) {\n          continue;\n        }\n\n        pose.frameImageDataUrl = `data:image/jpeg;base64,${imageBase64}`;\n      }\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Pose } from '../classes/pose';\n\n/**\n * ポーズを管理するためのサービス\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class PoseComposerService {\n  constructor() {}\n\n  init(videoName: string): Pose {\n    const pose = new Pose();\n    pose.setVideoName(videoName);\n    return pose;\n  }\n\n  downloadAsJson(pose: Pose) {\n    const blob = new Blob([pose.getJson()], {\n      type: 'application/json',\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.target = '_blank';\n    a.download = `${pose.getVideoName()}-poses.json`;\n    a.click();\n  }\n\n  async downloadAsZip(pose: Pose) {\n    const content = await pose.getZip();\n    const url = window.URL.createObjectURL(content);\n    const a = document.createElement('a');\n    a.href = url;\n    a.target = '_blank';\n    a.download = `${pose.getVideoName()}-poses.zip`;\n    a.click();\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport {\n  HAND_CONNECTIONS,\n  Holistic,\n  NormalizedLandmark,\n  NormalizedLandmarkList,\n  POSE_CONNECTIONS,\n  POSE_LANDMARKS,\n  POSE_LANDMARKS_LEFT,\n  POSE_LANDMARKS_RIGHT,\n  Results,\n} from '@mediapipe/holistic';\nimport { drawConnectors, drawLandmarks, lerp } from '@mediapipe/drawing_utils';\n\n/**\n * MediaPipe を用いて動画からポーズを抽出するためのサービス\n *\n * ※ シングルトンなサービスではないため、Component で providers に指定して使用することを想定\n */\n@Injectable()\nexport class PoseExtractorService {\n  public onResultsEventEmitter: EventEmitter<{\n    mpResults: Results;\n    posePreviewImageDataUrl: string;\n  }> = new EventEmitter();\n\n  private holistic?: Holistic;\n\n  private posePreviewCanvasElement?: HTMLCanvasElement;\n  private posePreviewCanvasContext?: CanvasRenderingContext2D;\n\n  private handPreviewCanvasElement?: HTMLCanvasElement;\n  private handPreviewCanvasContext?: CanvasRenderingContext2D;\n\n  constructor() {\n    this.init();\n  }\n\n  public getPosePreviewMediaStream(): MediaStream | undefined {\n    if (!this.posePreviewCanvasElement) return;\n    return this.posePreviewCanvasElement.captureStream();\n  }\n\n  public getHandPreviewMediaStream(): MediaStream | undefined {\n    if (!this.handPreviewCanvasElement) return;\n    return this.handPreviewCanvasElement.captureStream();\n  }\n\n  public async onVideoFrame(videoElement: HTMLVideoElement) {\n    if (!this.holistic) return;\n\n    if (this.posePreviewCanvasElement) {\n      this.posePreviewCanvasElement.width = videoElement.videoWidth;\n      this.posePreviewCanvasElement.height = videoElement.videoHeight;\n    }\n\n    if (this.handPreviewCanvasElement) {\n      this.handPreviewCanvasElement.width = videoElement.videoWidth;\n      this.handPreviewCanvasElement.height = videoElement.videoHeight;\n    }\n\n    await this.holistic.send({ image: videoElement });\n  }\n\n  private init() {\n    this.posePreviewCanvasElement = document.createElement('canvas');\n    this.posePreviewCanvasContext =\n      this.posePreviewCanvasElement.getContext('2d') || undefined;\n\n    this.handPreviewCanvasElement = document.createElement('canvas');\n    this.handPreviewCanvasContext =\n      this.handPreviewCanvasElement.getContext('2d') || undefined;\n\n    this.holistic = new Holistic({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;\n      },\n    });\n\n    this.holistic.setOptions({\n      selfieMode: false,\n      modelComplexity: 1,\n      smoothLandmarks: true,\n      enableSegmentation: false,\n      smoothSegmentation: true,\n      minDetectionConfidence: 0.6,\n      minTrackingConfidence: 0.6,\n    });\n\n    this.holistic.onResults((results: Results) => {\n      this.onResults(results);\n    });\n  }\n\n  private onResults(results: Results) {\n    if (\n      !this.posePreviewCanvasElement ||\n      !this.posePreviewCanvasContext ||\n      !this.holistic\n    )\n      return;\n\n    // 描画用に不必要なランドマークを除去\n    let poseLandmarks: NormalizedLandmarkList = [];\n    if (results.poseLandmarks) {\n      poseLandmarks = JSON.parse(\n        JSON.stringify(results.poseLandmarks)\n      ) as NormalizedLandmarkList;\n      this.removeElements(\n        poseLandmarks,\n        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 16, 17, 18, 19, 20, 21, 22]\n      );\n    }\n\n    // キャンバスを塗りつぶし\n    this.posePreviewCanvasContext.save();\n    this.posePreviewCanvasContext.clearRect(\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 検出に使用したフレーム画像を描画\n    this.posePreviewCanvasContext.drawImage(\n      results.image,\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 肘と手をつなぐ線を描画\n    this.posePreviewCanvasContext.lineWidth = 5;\n    if (poseLandmarks) {\n      if (results.rightHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW],\n            results.rightHandLandmarks[0],\n          ],\n        ]);\n      }\n      if (results.leftHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW],\n            results.leftHandLandmarks[0],\n          ],\n        ]);\n      }\n    }\n\n    // ポーズのプレビューを描画\n    if (poseLandmarks) {\n      drawConnectors(\n        this.posePreviewCanvasContext,\n        poseLandmarks,\n        POSE_CONNECTIONS,\n        { color: 'white' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_LEFT).map((index) => poseLandmarks[index]),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(255,138,0)' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_RIGHT).map(\n          (index) => poseLandmarks[index]\n        ),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(0,217,231)' }\n      );\n    }\n\n    // 手のプレビューを描画\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.rightHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.rightHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(0,217,231)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.leftHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.leftHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(255,138,0)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n\n    // 手の領域のみのプレビューを生成\n    if (this.handPreviewCanvasContext && this.handPreviewCanvasElement) {\n      const HAND_PREVIEW_ZOOM = 3;\n      const handPreviewBaseY = this.handPreviewCanvasElement.height / 2;\n\n      this.handPreviewCanvasContext.clearRect(\n        0,\n        0,\n        this.handPreviewCanvasElement.width,\n        this.handPreviewCanvasElement.height\n      );\n\n      if (results.rightHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.rightHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX = 0;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n\n      if (results.leftHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.leftHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX =\n          this.handPreviewCanvasElement.width - rect[2] * HAND_PREVIEW_ZOOM;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n    }\n\n    // イベントを送出\n    this.onResultsEventEmitter.emit({\n      mpResults: results,\n      posePreviewImageDataUrl:\n        this.posePreviewCanvasElement.toDataURL('image/jpeg'),\n    });\n\n    // 完了\n    this.posePreviewCanvasContext.restore();\n  }\n\n  private connect(\n    ctx: CanvasRenderingContext2D,\n    connectors: Array<[NormalizedLandmark, NormalizedLandmark]>\n  ) {\n    const canvas = ctx.canvas;\n    for (const connector of connectors) {\n      const from = connector[0];\n      const to = connector[1];\n      if (from && to) {\n        if (\n          from.visibility &&\n          to.visibility &&\n          (from.visibility < 0.1 || to.visibility < 0.1)\n        ) {\n          continue;\n        }\n        ctx.beginPath();\n        ctx.moveTo(from.x * canvas.width, from.y * canvas.height);\n        ctx.lineTo(to.x * canvas.width, to.y * canvas.height);\n        ctx.stroke();\n      }\n    }\n  }\n\n  private removeElements(\n    landmarks: NormalizedLandmarkList,\n    elements: number[]\n  ) {\n    for (const element of elements) {\n      delete landmarks[element];\n    }\n  }\n\n  private getRectByLandmarks(landmarks: any[], width: number, height: number) {\n    const leftHandLandmarksX = landmarks.map((landmark) => landmark.x * width);\n    const leftHandLandmarksY = landmarks.map((landmark) => landmark.y * height);\n    const minX = Math.min(...leftHandLandmarksX);\n    const maxX = Math.max(...leftHandLandmarksX);\n    const minY = Math.min(...leftHandLandmarksY);\n    const maxY = Math.max(...leftHandLandmarksY);\n    return [minX, minY, maxX - minX, maxY - minY];\n  }\n}\n","/*\n * Public API Surface of ngx-mp-pose-extractor\n */\n\nexport * from './lib/ngx-mp-pose-extractor.service';\nexport * from './lib/ngx-mp-pose-extractor.component';\nexport * from './lib/ngx-mp-pose-extractor.module';\n\nexport * from './lib/interfaces/pose-vector';\nexport * from './lib/interfaces/pose-item';\nexport * from './lib/interfaces/pose-json-item';\nexport * from './lib/interfaces/pose-json';\n\nexport * from './lib/classes/pose';\n\nexport * from './lib/services/pose-composer.service';\nexport * from './lib/services/pose-extractor.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}