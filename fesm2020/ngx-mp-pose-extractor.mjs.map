{"version":3,"file":"ngx-mp-pose-extractor.mjs","sources":["../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.component.ts","../../../projects/ngx-mp-pose-extractor/src/lib/ngx-mp-pose-extractor.module.ts","../../../projects/ngx-mp-pose-extractor/src/lib/classes/internals/image-trimmer.ts","../../../projects/ngx-mp-pose-extractor/src/lib/classes/pose-set.ts","../../../projects/ngx-mp-pose-extractor/src/lib/services/pose-composer.service.ts","../../../projects/ngx-mp-pose-extractor/src/lib/services/pose-extractor.service.ts","../../../projects/ngx-mp-pose-extractor/src/public-api.ts","../../../projects/ngx-mp-pose-extractor/src/ngx-mp-pose-extractor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgxMpPoseExtractorService {\n\n  constructor() { }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'lib-ngx-mp-pose-extractor',\n  template: `\n    <p>\n      ngx-mp-pose-extractor works!\n    </p>\n  `,\n  styles: [\n  ]\n})\nexport class NgxMpPoseExtractorComponent {\n\n}\n","import { NgModule } from '@angular/core';\nimport { NgxMpPoseExtractorComponent } from './ngx-mp-pose-extractor.component';\n\n@NgModule({\n  declarations: [NgxMpPoseExtractorComponent],\n  imports: [],\n  exports: [NgxMpPoseExtractorComponent],\n})\nexport class NgxMpPoseExtractorModule {}\n","import { lstat } from 'fs';\n\nexport class ImageTrimmer {\n  private canvas?: HTMLCanvasElement;\n  private context?: CanvasRenderingContext2D;\n\n  constructor() {}\n\n  async loadByDataUrl(dataUrl: string) {\n    const image: HTMLImageElement = await new Promise((resolve, reject) => {\n      const image = new Image();\n      image.src = dataUrl;\n      image.onload = () => {\n        resolve(image);\n      };\n    });\n\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d')!;\n    canvas.width = image.width;\n    canvas.height = image.height;\n    context.drawImage(image, 0, 0);\n\n    this.canvas = canvas;\n    this.context = context;\n  }\n\n  async trimMargin(marginColor: string, diffThreshold: number = 10) {\n    if (this.canvas === undefined) throw new Error('Image is not loaded');\n\n    // マージンを検出する範囲を指定 (左端から0〜20%)\n    const edgeDetectionRangeMinX = 0;\n    const edgeDetectionRangeMaxX = Math.floor(this.canvas.width * 0.2);\n\n    // マージンの端を検出\n    const edgePositionFromTop = await this.getVerticalEdgePositionOfColor(\n      marginColor,\n      'top',\n      diffThreshold,\n      edgeDetectionRangeMinX,\n      edgeDetectionRangeMaxX\n    );\n    const marginTop = edgePositionFromTop != null ? edgePositionFromTop : 0;\n\n    const edgePositionFromBottom = await this.getVerticalEdgePositionOfColor(\n      marginColor,\n      'bottom',\n      diffThreshold,\n      edgeDetectionRangeMinX,\n      edgeDetectionRangeMaxX\n    );\n    const marginBottom =\n      edgePositionFromBottom != null\n        ? edgePositionFromBottom\n        : this.canvas.height;\n\n    const oldHeight = this.canvas.height;\n    const newHeight = marginBottom - marginTop;\n    this.crop(0, marginTop, this.canvas.width, newHeight);\n\n    return {\n      marginTop: marginTop,\n      marginBottom: marginBottom,\n      heightNew: newHeight,\n      heightOld: oldHeight,\n      width: this.canvas.width,\n    };\n  }\n\n  async crop(x: number, y: number, w: number, h: number) {\n    if (!this.canvas || !this.context) return;\n\n    const newCanvas = document.createElement('canvas');\n    const newContext = newCanvas.getContext('2d')!;\n    newCanvas.width = w;\n    newCanvas.height = h;\n    newContext.drawImage(\n      this.canvas,\n      x,\n      y,\n      newCanvas.width,\n      newCanvas.height,\n      0,\n      0,\n      newCanvas.width,\n      newCanvas.height\n    );\n    this.replaceCanvas(newCanvas);\n  }\n\n  async replaceColor(\n    srcColor: string,\n    dstColor: string,\n    diffThreshold: number\n  ) {\n    if (!this.canvas || !this.context) return;\n\n    const imageData = this.context.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n\n    const dstColorValue = this.hexColorCodeToRgba(dstColor);\n\n    for (let x = 0; x < imageData.width; x++) {\n      for (let y = 0; y < imageData.height; y++) {\n        const idx = (x + y * imageData.width) * 4;\n        const red = imageData.data[idx + 0];\n        const green = imageData.data[idx + 1];\n        const blue = imageData.data[idx + 2];\n        const alpha = imageData.data[idx + 3];\n\n        const colorCode = this.rgbToHexColorCode(red, green, blue);\n        if (!this.isSimilarColor(srcColor, colorCode, diffThreshold)) {\n          continue;\n        }\n\n        imageData.data[idx + 0] = dstColorValue.r;\n        imageData.data[idx + 1] = dstColorValue.g;\n        imageData.data[idx + 2] = dstColorValue.b;\n        if (dstColorValue.a !== undefined) {\n          imageData.data[idx + 3] = dstColorValue.a;\n        }\n      }\n    }\n\n    this.context.putImageData(imageData, 0, 0);\n  }\n\n  async getMarginColor() {\n    if (!this.canvas || !this.context) {\n      return null;\n    }\n    let marginColor: string | null = null;\n\n    const imageData = this.context.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n\n    let isBreak = false;\n    for (let x = 0; x < imageData.width && !isBreak; x++) {\n      for (let y = 0; y < imageData.height; y++) {\n        const idx = (x + y * imageData.width) * 4;\n        const red = imageData.data[idx + 0];\n        const green = imageData.data[idx + 1];\n        const blue = imageData.data[idx + 2];\n        const alpha = imageData.data[idx + 3];\n\n        const colorCode = this.rgbToHexColorCode(red, green, blue);\n        if (marginColor != colorCode) {\n          if (marginColor === null) {\n            marginColor = colorCode;\n          } else {\n            isBreak = true;\n            break;\n          }\n        }\n      }\n    }\n\n    return marginColor;\n  }\n\n  async getVerticalEdgePositionOfColor(\n    color: string,\n    direction: 'top' | 'bottom',\n    diffThreshold: number,\n    minX?: number,\n    maxX?: number\n  ) {\n    if (!this.canvas || !this.context) {\n      return null;\n    }\n\n    if (minX === undefined) {\n      minX = 0;\n    }\n    if (maxX === undefined) {\n      maxX = this.canvas.width;\n    }\n\n    const imageData = this.context.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n\n    let isBreak = false;\n\n    let edgePositionY;\n    if (direction === 'top') {\n      edgePositionY = 0;\n\n      for (let y = 0; y < imageData.height; y++) {\n        for (let x = 0; x < maxX && !isBreak; x++) {\n          const idx = (x + y * imageData.width) * 4;\n          const red = imageData.data[idx + 0];\n          const green = imageData.data[idx + 1];\n          const blue = imageData.data[idx + 2];\n          const alpha = imageData.data[idx + 3];\n\n          const colorCode = this.rgbToHexColorCode(red, green, blue);\n          if (\n            color == colorCode ||\n            this.isSimilarColor(color, colorCode, diffThreshold)\n          ) {\n            if (edgePositionY < y) {\n              edgePositionY = y;\n            }\n          } else {\n            isBreak = true;\n            break;\n          }\n        }\n      }\n\n      if (edgePositionY !== 0) {\n        edgePositionY += 1;\n      }\n    } else if (direction === 'bottom') {\n      edgePositionY = this.canvas.height;\n\n      for (let y = imageData.height - 1; y >= 0; y--) {\n        for (let x = 0; x < imageData.width && !isBreak; x++) {\n          const idx = (x + y * imageData.width) * 4;\n          const red = imageData.data[idx + 0];\n          const green = imageData.data[idx + 1];\n          const blue = imageData.data[idx + 2];\n          const alpha = imageData.data[idx + 3];\n\n          const colorCode = this.rgbToHexColorCode(red, green, blue);\n          if (\n            color == colorCode ||\n            this.isSimilarColor(color, colorCode, diffThreshold)\n          ) {\n            if (edgePositionY > y) {\n              edgePositionY = y;\n            }\n          } else {\n            isBreak = true;\n            break;\n          }\n        }\n      }\n\n      if (edgePositionY !== this.canvas.height) {\n        edgePositionY -= 1;\n      }\n    }\n\n    return edgePositionY;\n  }\n\n  async getWidth() {\n    return this.canvas?.width;\n  }\n\n  async getHeight() {\n    return this.canvas?.height;\n  }\n\n  async resizeWithFit(param: { width?: number; height?: number }) {\n    if (!this.canvas) {\n      return;\n    }\n\n    let newWidth: number = 0,\n      newHeight: number = 0;\n    if (param.width && this.canvas.width > param.width) {\n      newWidth = param.width ? param.width : this.canvas.width;\n      newHeight = this.canvas.height * (newWidth / this.canvas.width);\n    } else if (param.height && this.canvas.height > param.height) {\n      newHeight = param.height ? param.height : this.canvas.height;\n      newWidth = this.canvas.width * (newHeight / this.canvas.height);\n    } else {\n      return;\n    }\n\n    const newCanvas = document.createElement('canvas');\n    const newContext = newCanvas.getContext('2d')!;\n    newCanvas.width = newWidth;\n    newCanvas.height = newHeight;\n    newContext.drawImage(this.canvas, 0, 0, newWidth, newHeight);\n    this.replaceCanvas(newCanvas);\n  }\n\n  private replaceCanvas(canvas: HTMLCanvasElement) {\n    if (!this.canvas || !this.context) {\n      this.canvas = canvas;\n      this.context = this.canvas.getContext('2d')!;\n      return;\n    }\n\n    this.canvas.width = 0;\n    this.canvas.height = 0;\n    delete this.canvas;\n    delete this.context;\n\n    this.canvas = canvas;\n    this.context = this.canvas.getContext('2d')!;\n  }\n\n  async getDataUrl(\n    mime: 'image/jpeg' | 'image/png' | 'image/webp' = 'image/jpeg',\n    imageQuality?: number\n  ) {\n    if (!this.canvas) {\n      return null;\n    }\n\n    if (mime === 'image/jpeg' || mime === 'image/webp') {\n      return this.canvas.toDataURL(mime, imageQuality);\n    } else {\n      return this.canvas.toDataURL(mime);\n    }\n  }\n\n  private hexColorCodeToRgba(color: string): {\n    r: number;\n    g: number;\n    b: number;\n    a?: number;\n  } {\n    const r = parseInt(color.substr(1, 2), 16);\n    const g = parseInt(color.substr(3, 2), 16);\n    const b = parseInt(color.substr(5, 2), 16);\n    if (color.length === 9) {\n      const a = parseInt(color.substr(7, 2), 16);\n      return { r, g, b, a };\n    }\n    return { r, g, b };\n  }\n\n  private rgbToHexColorCode(r: number, g: number, b: number) {\n    return '#' + this.valueToHex(r) + this.valueToHex(g) + this.valueToHex(b);\n  }\n\n  private valueToHex(value: number) {\n    return ('0' + value.toString(16)).slice(-2);\n  }\n\n  private isSimilarColor(\n    color1: string,\n    color2: string,\n    diffThreshold: number\n  ) {\n    const color1Rgb = this.hexColorCodeToRgba(color1);\n    const color2Rgb = this.hexColorCodeToRgba(color2);\n    const diff =\n      Math.abs(color1Rgb.r - color2Rgb.r) +\n      Math.abs(color1Rgb.g - color2Rgb.g) +\n      Math.abs(color1Rgb.b - color2Rgb.b);\n    return diff < diffThreshold;\n  }\n}\n","import { POSE_LANDMARKS, Results } from '@mediapipe/holistic';\nimport * as JSZip from 'jszip';\nimport { PoseSetItem } from '../interfaces/pose-set-item';\nimport { PoseSetJson } from '../interfaces/pose-set-json';\nimport { PoseSetJsonItem } from '../interfaces/pose-set-json-item';\nimport { BodyVector } from '../interfaces/body-vector';\n\n// @ts-ignore\nimport cosSimilarityA from 'cos-similarity';\n// @ts-ignore\nimport * as cosSimilarityB from 'cos-similarity';\n\nimport { SimilarPoseItem } from '../interfaces/similar-pose-item';\nimport { ImageTrimmer } from './internals/image-trimmer';\nimport { HandVector } from '../interfaces/hand-vector';\n\nexport class PoseSet {\n  public generator?: string;\n  public version?: number;\n  private videoMetadata!: {\n    name: string;\n    width: number;\n    height: number;\n    duration: number;\n    firstPoseDetectedTime: number;\n  };\n  public poses: PoseSetItem[] = [];\n  public isFinalized?: boolean = false;\n\n  // BodyVector のキー名\n  public static readonly BODY_VECTOR_MAPPINGS = [\n    // 右腕\n    'rightWristToRightElbow',\n    'rightElbowToRightShoulder',\n    // 左腕\n    'leftWristToLeftElbow',\n    'leftElbowToLeftShoulder',\n  ];\n\n  // HandVector のキー名\n  public static readonly HAND_VECTOR_MAPPINGS = [\n    // 右手 - 親指\n    'rightThumbTipToFirstJoint',\n    'rightThumbFirstJointToSecondJoint',\n    // 右手 - 人差し指\n    'rightIndexFingerTipToFirstJoint',\n    'rightIndexFingerFirstJointToSecondJoint',\n    // 右手 - 中指\n    'rightMiddleFingerTipToFirstJoint',\n    'rightMiddleFingerFirstJointToSecondJoint',\n    // 右手 - 薬指\n    'rightRingFingerTipToFirstJoint',\n    'rightRingFingerFirstJointToSecondJoint',\n    // 右手 - 小指\n    'rightPinkyFingerTipToFirstJoint',\n    'rightPinkyFingerFirstJointToSecondJoint',\n    // 左手 - 親指\n    'leftThumbTipToFirstJoint',\n    'leftThumbFirstJointToSecondJoint',\n    // 左手 - 人差し指\n    'leftIndexFingerTipToFirstJoint',\n    'leftIndexFingerFirstJointToSecondJoint',\n    // 左手 - 中指\n    'leftMiddleFingerTipToFirstJoint',\n    'leftMiddleFingerFirstJointToSecondJoint',\n    // 左手 - 薬指\n    'leftRingFingerTipToFirstJoint',\n    'leftRingFingerFirstJointToSecondJoint',\n    // 左手 - 小指\n    'leftPinkyFingerTipToFirstJoint',\n    'leftPinkyFingerFirstJointToSecondJoint',\n  ];\n\n  // ポーズを追加するためのキュー\n  private similarPoseQueue: PoseSetItem[] = [];\n\n  // 類似ポーズの除去 - 各ポーズの前後から\n  private readonly IS_ENABLED_REMOVE_DUPLICATED_POSES_FOR_AROUND = true;\n\n  // 画像書き出し時の設定\n  private readonly IMAGE_WIDTH: number = 1080;\n  private readonly IMAGE_MIME: 'image/jpeg' | 'image/png' | 'image/webp' =\n    'image/webp';\n  private readonly IMAGE_QUALITY = 0.8;\n\n  // 画像の余白除去\n  private readonly IMAGE_MARGIN_TRIMMING_COLOR = '#000000';\n  private readonly IMAGE_MARGIN_TRIMMING_DIFF_THRESHOLD = 50;\n\n  // 画像の背景色置換\n  private readonly IMAGE_BACKGROUND_REPLACE_SRC_COLOR = '#016AFD';\n  private readonly IMAGE_BACKGROUND_REPLACE_DST_COLOR = '#FFFFFF00';\n  private readonly IMAGE_BACKGROUND_REPLACE_DIFF_THRESHOLD = 130;\n\n  constructor() {\n    this.videoMetadata = {\n      name: '',\n      width: 0,\n      height: 0,\n      duration: 0,\n      firstPoseDetectedTime: 0,\n    };\n  }\n\n  getVideoName() {\n    return this.videoMetadata.name;\n  }\n\n  setVideoName(videoName: string) {\n    this.videoMetadata.name = videoName;\n  }\n\n  setVideoMetaData(width: number, height: number, duration: number) {\n    this.videoMetadata.width = width;\n    this.videoMetadata.height = height;\n    this.videoMetadata.duration = duration;\n  }\n\n  /**\n   * ポーズ数の取得\n   * @returns\n   */\n  getNumberOfPoses(): number {\n    if (this.poses === undefined) return -1;\n    return this.poses.length;\n  }\n\n  /**\n   * 全ポーズの取得\n   * @returns 全てのポーズ\n   */\n  getPoses(): PoseSetItem[] {\n    if (this.poses === undefined) return [];\n    return this.poses;\n  }\n\n  /**\n   * 指定されたID (PoseSetItemId) によるポーズの取得\n   * @param poseSetItemId\n   * @returns ポーズ\n   */\n  getPoseById(poseSetItemId: number): PoseSetItem | undefined {\n    if (this.poses === undefined) return undefined;\n    return this.poses.find((pose) => pose.id === poseSetItemId);\n  }\n\n  /**\n   * 指定された時間によるポーズの取得\n   * @param timeMiliseconds ポーズの時間 (ミリ秒)\n   * @returns ポーズ\n   */\n  getPoseByTime(timeMiliseconds: number): PoseSetItem | undefined {\n    if (this.poses === undefined) return undefined;\n    return this.poses.find((pose) => pose.timeMiliseconds === timeMiliseconds);\n  }\n\n  /**\n   * ポーズの追加\n   */\n  pushPose(\n    videoTimeMiliseconds: number,\n    frameImageDataUrl: string | undefined,\n    poseImageDataUrl: string | undefined,\n    faceFrameImageDataUrl: string | undefined,\n    results: Results\n  ): PoseSetItem | undefined {\n    if (this.poses.length === 0) {\n      this.videoMetadata.firstPoseDetectedTime = videoTimeMiliseconds;\n    }\n\n    if (results.poseLandmarks === undefined) {\n      console.debug(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get poseLandmarks`,\n        results\n      );\n      return;\n    }\n\n    const poseLandmarksWithWorldCoordinate: any[] = (results as any).ea\n      ? (results as any).ea\n      : [];\n    if (poseLandmarksWithWorldCoordinate.length === 0) {\n      console.debug(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the pose with the world coordinate`,\n        results\n      );\n      return;\n    }\n\n    const bodyVector = PoseSet.getBodyVector(poseLandmarksWithWorldCoordinate);\n    if (!bodyVector) {\n      console.warn(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the body vector`,\n        poseLandmarksWithWorldCoordinate\n      );\n      return;\n    }\n\n    if (\n      results.leftHandLandmarks === undefined &&\n      results.rightHandLandmarks === undefined\n    ) {\n      console.debug(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the hand landmarks`,\n        results\n      );\n    } else if (results.leftHandLandmarks === undefined) {\n      console.debug(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the left hand landmarks`,\n        results\n      );\n    } else if (results.rightHandLandmarks === undefined) {\n      console.debug(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the right hand landmarks`,\n        results\n      );\n    }\n\n    const handVector = PoseSet.getHandVector(\n      results.leftHandLandmarks,\n      results.rightHandLandmarks\n    );\n    if (!handVector) {\n      console.warn(\n        `[PoseSet] pushPose (${videoTimeMiliseconds}) - Could not get the hand vector`,\n        results\n      );\n    }\n\n    const pose: PoseSetItem = {\n      id: PoseSet.getIdByTimeMiliseconds(videoTimeMiliseconds),\n      timeMiliseconds: videoTimeMiliseconds,\n      durationMiliseconds: -1,\n      pose: poseLandmarksWithWorldCoordinate.map((worldCoordinateLandmark) => {\n        return [\n          worldCoordinateLandmark.x,\n          worldCoordinateLandmark.y,\n          worldCoordinateLandmark.z,\n          worldCoordinateLandmark.visibility,\n        ];\n      }),\n      leftHand: results.leftHandLandmarks?.map((normalizedLandmark) => {\n        return [\n          normalizedLandmark.x,\n          normalizedLandmark.y,\n          normalizedLandmark.z,\n        ];\n      }),\n      rightHand: results.rightHandLandmarks?.map((normalizedLandmark) => {\n        return [\n          normalizedLandmark.x,\n          normalizedLandmark.y,\n          normalizedLandmark.z,\n        ];\n      }),\n      bodyVector: bodyVector,\n      handVector: handVector,\n      frameImageDataUrl: frameImageDataUrl,\n      poseImageDataUrl: poseImageDataUrl,\n      faceFrameImageDataUrl: faceFrameImageDataUrl,\n      extendedData: {},\n      debug: {\n        duplicatedItems: [],\n      },\n      mergedTimeMiliseconds: videoTimeMiliseconds,\n      mergedDurationMiliseconds: -1,\n    };\n\n    let lastPose;\n    if (this.poses.length === 0 && 1 <= this.similarPoseQueue.length) {\n      // 類似ポーズキューから最後のポーズを取得\n      lastPose = this.similarPoseQueue[this.similarPoseQueue.length - 1];\n    } else if (1 <= this.poses.length) {\n      // ポーズ配列から最後のポーズを取得\n      lastPose = this.poses[this.poses.length - 1];\n    }\n\n    if (lastPose) {\n      // 最後のポーズがあれば、類似ポーズかどうかを比較\n      const isSimilarBodyPose = PoseSet.isSimilarBodyPose(\n        pose.bodyVector,\n        lastPose.bodyVector\n      );\n\n      let isSimilarHandPose = true;\n      if (lastPose.handVector && pose.handVector) {\n        isSimilarHandPose = PoseSet.isSimilarHandPose(\n          pose.handVector,\n          lastPose.handVector\n        );\n      } else if (!lastPose.handVector && pose.handVector) {\n        isSimilarHandPose = false;\n      }\n\n      if (!isSimilarBodyPose || !isSimilarHandPose) {\n        // 身体・手のいずれかが前のポーズと類似していないならば、類似ポーズキューを処理して、ポーズ配列へ追加\n        this.pushPoseFromSimilarPoseQueue(pose.timeMiliseconds);\n      }\n    }\n\n    // 類似ポーズキューへ追加\n    this.similarPoseQueue.push(pose);\n\n    return pose;\n  }\n\n  /**\n   * ポーズの配列からポーズが決まっている瞬間を取得\n   * @param poses ポーズの配列\n   * @returns ポーズが決まっている瞬間\n   */\n  static getSuitablePoseByPoses(poses: PoseSetItem[]): PoseSetItem {\n    if (poses.length === 0) return null;\n    if (poses.length === 1) {\n      return poses[1];\n    }\n\n    // 各標本ポーズごとの類似度を初期化\n    const similaritiesOfPoses: {\n      [key: number]: {\n        handSimilarity: number;\n        bodySimilarity: number;\n      }[];\n    } = {};\n    for (let i = 0; i < poses.length; i++) {\n      similaritiesOfPoses[poses[i].timeMiliseconds] = poses.map(\n        (pose: PoseSetItem) => {\n          return {\n            handSimilarity: 0,\n            bodySimilarity: 0,\n          };\n        }\n      );\n    }\n\n    // 各標本ポーズごとの類似度を計算\n    for (let samplePose of poses) {\n      let handSimilarity: number;\n\n      for (let i = 0; i < poses.length; i++) {\n        const pose = poses[i];\n        if (pose.handVector && samplePose.handVector) {\n          handSimilarity = PoseSet.getHandSimilarity(\n            pose.handVector,\n            samplePose.handVector\n          );\n        }\n\n        let bodySimilarity = PoseSet.getBodyPoseSimilarity(\n          pose.bodyVector,\n          samplePose.bodyVector\n        );\n\n        similaritiesOfPoses[samplePose.timeMiliseconds][i] = {\n          handSimilarity: handSimilarity ?? 0,\n          bodySimilarity,\n        };\n      }\n    }\n\n    // 類似度の高いフレームが多かったポーズを選択\n    const similaritiesOfSamplePoses = poses.map((pose: PoseSetItem) => {\n      return similaritiesOfPoses[pose.timeMiliseconds].reduce(\n        (\n          prev: number,\n          current: { handSimilarity: number; bodySimilarity: number }\n        ) => {\n          return prev + current.handSimilarity + current.bodySimilarity;\n        },\n        0\n      );\n    });\n    const maxSimilarity = Math.max(...similaritiesOfSamplePoses);\n    const maxSimilarityIndex = similaritiesOfSamplePoses.indexOf(maxSimilarity);\n    const selectedPose = poses[maxSimilarityIndex];\n    if (!selectedPose) {\n      console.warn(\n        `[PoseSet] getSuitablePoseByPoses`,\n        similaritiesOfSamplePoses,\n        maxSimilarity,\n        maxSimilarityIndex\n      );\n    }\n\n    console.debug(`[PoseSet] getSuitablePoseByPoses`, {\n      selected: selectedPose,\n      unselected: poses.filter((pose: PoseSetItem) => {\n        return pose.timeMiliseconds !== selectedPose.timeMiliseconds;\n      }),\n    });\n    return selectedPose;\n  }\n\n  /**\n   * 最終処理\n   * (重複したポーズの除去、画像のマージン除去など)\n   */\n  async finalize(isRemoveDuplicate: boolean = true) {\n    if (this.similarPoseQueue.length > 0) {\n      // 類似ポーズキューにポーズが残っている場合、最適なポーズを選択してポーズ配列へ追加\n      this.pushPoseFromSimilarPoseQueue(this.videoMetadata.duration);\n    }\n\n    if (0 == this.poses.length) {\n      // ポーズが一つもない場合、処理を終了\n      this.isFinalized = true;\n      return;\n    }\n\n    // ポーズの持続時間を設定\n    for (let i = 0; i < this.poses.length - 1; i++) {\n      if (this.poses[i].durationMiliseconds === -1) {\n        this.poses[i].durationMiliseconds =\n          this.poses[i + 1].timeMiliseconds - this.poses[i].timeMiliseconds;\n      }\n      if (this.poses[i].mergedDurationMiliseconds === -1) {\n        this.poses[i].mergedDurationMiliseconds =\n          this.poses[i].durationMiliseconds;\n      }\n    }\n\n    if (this.poses[this.poses.length - 1].durationMiliseconds === -1) {\n      this.poses[this.poses.length - 1].durationMiliseconds =\n        this.videoMetadata.duration -\n        this.poses[this.poses.length - 1].timeMiliseconds;\n    }\n    if (this.poses[this.poses.length - 1].mergedDurationMiliseconds === -1) {\n      this.poses[this.poses.length - 1].mergedDurationMiliseconds =\n        this.poses[this.poses.length - 1].durationMiliseconds;\n    }\n\n    // 全体から重複ポーズを除去\n    if (isRemoveDuplicate) {\n      this.removeDuplicatedPoses();\n    }\n\n    // 最初のポーズを除去\n    this.poses.shift();\n\n    // 画像のマージンを取得\n    console.debug(`[PoseSet] finalize - Detecting image margins...`);\n    let imageTrimming:\n      | {\n          marginTop: number;\n          marginBottom: number;\n          heightNew: number;\n          heightOld: number;\n          width: number;\n        }\n      | undefined = undefined;\n    for (const pose of this.poses) {\n      let imageTrimmer = new ImageTrimmer();\n      if (!pose.frameImageDataUrl) {\n        continue;\n      }\n      await imageTrimmer.loadByDataUrl(pose.frameImageDataUrl);\n\n      const marginColor = await imageTrimmer.getMarginColor();\n      console.debug(\n        `[PoseSet] finalize - Detected margin color...`,\n        pose.timeMiliseconds,\n        marginColor\n      );\n      if (marginColor === null) continue;\n      if (marginColor !== this.IMAGE_MARGIN_TRIMMING_COLOR) {\n        continue;\n      }\n      const trimmed = await imageTrimmer.trimMargin(\n        marginColor,\n        this.IMAGE_MARGIN_TRIMMING_DIFF_THRESHOLD\n      );\n      if (!trimmed) continue;\n      imageTrimming = trimmed;\n      console.debug(\n        `[PoseSet] finalize - Determined image trimming positions...`,\n        trimmed\n      );\n      break;\n    }\n\n    // 画像を整形\n    for (const pose of this.poses) {\n      let imageTrimmer = new ImageTrimmer();\n      if (!pose.frameImageDataUrl || !pose.poseImageDataUrl) {\n        continue;\n      }\n\n      console.debug(\n        `[PoseSet] finalize - Processing image...`,\n        pose.timeMiliseconds\n      );\n\n      // 画像を整形 - フレーム画像\n      await imageTrimmer.loadByDataUrl(pose.frameImageDataUrl);\n\n      if (imageTrimming) {\n        await imageTrimmer.crop(\n          0,\n          imageTrimming.marginTop,\n          imageTrimming.width,\n          imageTrimming.heightNew\n        );\n      }\n\n      await imageTrimmer.replaceColor(\n        this.IMAGE_BACKGROUND_REPLACE_SRC_COLOR,\n        this.IMAGE_BACKGROUND_REPLACE_DST_COLOR,\n        this.IMAGE_BACKGROUND_REPLACE_DIFF_THRESHOLD\n      );\n\n      await imageTrimmer.resizeWithFit({\n        width: this.IMAGE_WIDTH,\n      });\n\n      let newDataUrl = await imageTrimmer.getDataUrl(\n        this.IMAGE_MIME,\n        this.IMAGE_MIME === 'image/jpeg' || this.IMAGE_MIME === 'image/webp'\n          ? this.IMAGE_QUALITY\n          : undefined\n      );\n      if (!newDataUrl) {\n        console.warn(\n          `[PoseSet] finalize - Could not get the new dataurl for frame image`\n        );\n        continue;\n      }\n      pose.frameImageDataUrl = newDataUrl;\n\n      // 画像を整形 - ポーズプレビュー画像\n      imageTrimmer = new ImageTrimmer();\n      await imageTrimmer.loadByDataUrl(pose.poseImageDataUrl);\n\n      if (imageTrimming) {\n        await imageTrimmer.crop(\n          0,\n          imageTrimming.marginTop,\n          imageTrimming.width,\n          imageTrimming.heightNew\n        );\n      }\n\n      await imageTrimmer.resizeWithFit({\n        width: this.IMAGE_WIDTH,\n      });\n\n      newDataUrl = await imageTrimmer.getDataUrl(\n        this.IMAGE_MIME,\n        this.IMAGE_MIME === 'image/jpeg' || this.IMAGE_MIME === 'image/webp'\n          ? this.IMAGE_QUALITY\n          : undefined\n      );\n      if (!newDataUrl) {\n        console.warn(\n          `[PoseSet] finalize - Could not get the new dataurl for pose preview image`\n        );\n        continue;\n      }\n      pose.poseImageDataUrl = newDataUrl;\n\n      if (pose.faceFrameImageDataUrl) {\n        // 画像を整形 - 顔フレーム画像\n        imageTrimmer = new ImageTrimmer();\n        await imageTrimmer.loadByDataUrl(pose.faceFrameImageDataUrl);\n\n        newDataUrl = await imageTrimmer.getDataUrl(\n          this.IMAGE_MIME,\n          this.IMAGE_MIME === 'image/jpeg' || this.IMAGE_MIME === 'image/webp'\n            ? this.IMAGE_QUALITY\n            : undefined\n        );\n        if (!newDataUrl) {\n          console.warn(\n            `[PoseSet] finalize - Could not get the new dataurl for face frame image`\n          );\n          continue;\n        }\n        pose.faceFrameImageDataUrl = newDataUrl;\n      }\n    }\n\n    this.isFinalized = true;\n  }\n\n  /**\n   * 類似ポーズの取得\n   * @param results MediaPipe Holistic によるポーズの検出結果\n   * @param threshold しきい値\n   * @param targetRange ポーズを比較する範囲 (all: 全て, bodyPose: 身体のみ, handPose: 手指のみ)\n   * @returns 類似ポーズの配列\n   */\n  getSimilarPoses(\n    results: Results,\n    threshold: number = 0.9,\n    targetRange: 'all' | 'bodyPose' | 'handPose' = 'all'\n  ): SimilarPoseItem[] {\n    // 身体のベクトルを取得\n    let bodyVector: BodyVector;\n    try {\n      bodyVector = PoseSet.getBodyVector((results as any).ea);\n    } catch (e) {\n      console.error(`[PoseSet] getSimilarPoses - Error occurred`, e, results);\n      return [];\n    }\n    if (!bodyVector) {\n      throw 'Could not get the body vector';\n    }\n\n    // 手指のベクトルを取得\n    let handVector: HandVector;\n    if (targetRange === 'all' || targetRange === 'handPose') {\n      handVector = PoseSet.getHandVector(\n        results.leftHandLandmarks,\n        results.rightHandLandmarks\n      );\n      if (targetRange === 'handPose' && !handVector) {\n        throw 'Could not get the hand vector';\n      }\n    }\n\n    // 各ポーズとベクトルを比較\n    const poses = [];\n    for (const pose of this.poses) {\n      if (\n        (targetRange === 'all' || targetRange === 'bodyPose') &&\n        !pose.bodyVector\n      ) {\n        continue;\n      } else if (targetRange === 'handPose' && !pose.handVector) {\n        continue;\n      }\n\n      /*console.debug(\n        '[PoseSet] getSimilarPoses - ',\n        this.getVideoName(),\n        pose.timeMiliseconds\n      );*/\n\n      // 身体のポーズの類似度を取得\n      let bodySimilarity: number;\n      if (bodyVector && pose.bodyVector) {\n        bodySimilarity = PoseSet.getBodyPoseSimilarity(\n          pose.bodyVector,\n          bodyVector\n        );\n      }\n\n      // 手指のポーズの類似度を取得\n      let handSimilarity: number;\n      if (handVector && pose.handVector) {\n        handSimilarity = PoseSet.getHandSimilarity(pose.handVector, handVector);\n      }\n\n      // 判定\n      let similarity: number,\n        isSimilar = false;\n      if (targetRange === 'all') {\n        similarity = Math.max(bodySimilarity ?? 0, handSimilarity ?? 0);\n        if (threshold <= bodySimilarity || threshold <= handSimilarity) {\n          isSimilar = true;\n        }\n      } else if (targetRange === 'bodyPose') {\n        similarity = bodySimilarity;\n        if (threshold <= bodySimilarity) {\n          isSimilar = true;\n        }\n      } else if (targetRange === 'handPose') {\n        similarity = handSimilarity;\n        if (threshold <= handSimilarity) {\n          isSimilar = true;\n        }\n      }\n\n      if (!isSimilar) continue;\n\n      // 結果へ追加\n      poses.push({\n        ...pose,\n        similarity: similarity,\n        bodyPoseSimilarity: bodySimilarity,\n        handPoseSimilarity: handSimilarity,\n      } as SimilarPoseItem);\n    }\n\n    return poses;\n  }\n\n  /**\n   * 身体の姿勢を表すベクトルの取得\n   * @param poseLandmarks MediaPipe Holistic で取得できた身体のワールド座標 (ra 配列)\n   * @returns ベクトル\n   */\n  static getBodyVector(\n    poseLandmarks: { x: number; y: number; z: number }[]\n  ): BodyVector | undefined {\n    return {\n      rightWristToRightElbow: [\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].x -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].x,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].y -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].y,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_WRIST].z -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].z,\n      ],\n      rightElbowToRightShoulder: [\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].x -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].x,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].y -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].y,\n        poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW].z -\n          poseLandmarks[POSE_LANDMARKS.RIGHT_SHOULDER].z,\n      ],\n      leftWristToLeftElbow: [\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].x -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].x,\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].y -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].y,\n        poseLandmarks[POSE_LANDMARKS.LEFT_WRIST].z -\n          poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].z,\n      ],\n      leftElbowToLeftShoulder: [\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].x -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].x,\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].y -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].y,\n        poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW].z -\n          poseLandmarks[POSE_LANDMARKS.LEFT_SHOULDER].z,\n      ],\n    };\n  }\n\n  /**\n   * 手指の姿勢を表すベクトルの取得\n   * @param leftHandLandmarks MediaPipe Holistic で取得できた左手の正規化座標\n   * @param rightHandLandmarks MediaPipe Holistic で取得できた右手の正規化座標\n   * @returns ベクトル\n   */\n  static getHandVector(\n    leftHandLandmarks: { x: number; y: number; z: number }[],\n    rightHandLandmarks: { x: number; y: number; z: number }[]\n  ): HandVector | undefined {\n    if (\n      (rightHandLandmarks === undefined || rightHandLandmarks.length === 0) &&\n      (leftHandLandmarks === undefined || leftHandLandmarks.length === 0)\n    ) {\n      return undefined;\n    }\n\n    return {\n      // 右手 - 親指\n      rightThumbTipToFirstJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[4].x - rightHandLandmarks[3].x,\n              rightHandLandmarks[4].y - rightHandLandmarks[3].y,\n              rightHandLandmarks[4].z - rightHandLandmarks[3].z,\n            ],\n      rightThumbFirstJointToSecondJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[3].x - rightHandLandmarks[2].x,\n              rightHandLandmarks[3].y - rightHandLandmarks[2].y,\n              rightHandLandmarks[3].z - rightHandLandmarks[2].z,\n            ],\n      // 右手 - 人差し指\n      rightIndexFingerTipToFirstJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[8].x - rightHandLandmarks[7].x,\n              rightHandLandmarks[8].y - rightHandLandmarks[7].y,\n              rightHandLandmarks[8].z - rightHandLandmarks[7].z,\n            ],\n      rightIndexFingerFirstJointToSecondJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[7].x - rightHandLandmarks[6].x,\n              rightHandLandmarks[7].y - rightHandLandmarks[6].y,\n              rightHandLandmarks[7].z - rightHandLandmarks[6].z,\n            ],\n      // 右手 - 中指\n      rightMiddleFingerTipToFirstJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[12].x - rightHandLandmarks[11].x,\n              rightHandLandmarks[12].y - rightHandLandmarks[11].y,\n              rightHandLandmarks[12].z - rightHandLandmarks[11].z,\n            ],\n      rightMiddleFingerFirstJointToSecondJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[11].x - rightHandLandmarks[10].x,\n              rightHandLandmarks[11].y - rightHandLandmarks[10].y,\n              rightHandLandmarks[11].z - rightHandLandmarks[10].z,\n            ],\n      // 右手 - 薬指\n      rightRingFingerTipToFirstJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[16].x - rightHandLandmarks[15].x,\n              rightHandLandmarks[16].y - rightHandLandmarks[15].y,\n              rightHandLandmarks[16].z - rightHandLandmarks[15].z,\n            ],\n      rightRingFingerFirstJointToSecondJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[15].x - rightHandLandmarks[14].x,\n              rightHandLandmarks[15].y - rightHandLandmarks[14].y,\n              rightHandLandmarks[15].z - rightHandLandmarks[14].z,\n            ],\n      // 右手 - 小指\n      rightPinkyFingerTipToFirstJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[20].x - rightHandLandmarks[19].x,\n              rightHandLandmarks[20].y - rightHandLandmarks[19].y,\n              rightHandLandmarks[20].z - rightHandLandmarks[19].z,\n            ],\n      rightPinkyFingerFirstJointToSecondJoint:\n        rightHandLandmarks === undefined || rightHandLandmarks.length === 0\n          ? null\n          : [\n              rightHandLandmarks[19].x - rightHandLandmarks[18].x,\n              rightHandLandmarks[19].y - rightHandLandmarks[18].y,\n              rightHandLandmarks[19].z - rightHandLandmarks[18].z,\n            ],\n      // 左手 - 親指\n      leftThumbTipToFirstJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[4].x - leftHandLandmarks[3].x,\n              leftHandLandmarks[4].y - leftHandLandmarks[3].y,\n              leftHandLandmarks[4].z - leftHandLandmarks[3].z,\n            ],\n      leftThumbFirstJointToSecondJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[3].x - leftHandLandmarks[2].x,\n              leftHandLandmarks[3].y - leftHandLandmarks[2].y,\n              leftHandLandmarks[3].z - leftHandLandmarks[2].z,\n            ],\n      // 左手 - 人差し指\n      leftIndexFingerTipToFirstJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[8].x - leftHandLandmarks[7].x,\n              leftHandLandmarks[8].y - leftHandLandmarks[7].y,\n              leftHandLandmarks[8].z - leftHandLandmarks[7].z,\n            ],\n      leftIndexFingerFirstJointToSecondJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[7].x - leftHandLandmarks[6].x,\n              leftHandLandmarks[7].y - leftHandLandmarks[6].y,\n              leftHandLandmarks[7].z - leftHandLandmarks[6].z,\n            ],\n      // 左手 - 中指\n      leftMiddleFingerTipToFirstJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[12].x - leftHandLandmarks[11].x,\n              leftHandLandmarks[12].y - leftHandLandmarks[11].y,\n              leftHandLandmarks[12].z - leftHandLandmarks[11].z,\n            ],\n      leftMiddleFingerFirstJointToSecondJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[11].x - leftHandLandmarks[10].x,\n              leftHandLandmarks[11].y - leftHandLandmarks[10].y,\n              leftHandLandmarks[11].z - leftHandLandmarks[10].z,\n            ],\n      // 左手 - 薬指\n      leftRingFingerTipToFirstJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[16].x - leftHandLandmarks[15].x,\n              leftHandLandmarks[16].y - leftHandLandmarks[15].y,\n              leftHandLandmarks[16].z - leftHandLandmarks[15].z,\n            ],\n      leftRingFingerFirstJointToSecondJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[15].x - leftHandLandmarks[14].x,\n              leftHandLandmarks[15].y - leftHandLandmarks[14].y,\n              leftHandLandmarks[15].z - leftHandLandmarks[14].z,\n            ],\n      // 左手 - 小指\n      leftPinkyFingerTipToFirstJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[20].x - leftHandLandmarks[19].x,\n              leftHandLandmarks[20].y - leftHandLandmarks[19].y,\n              leftHandLandmarks[20].z - leftHandLandmarks[19].z,\n            ],\n      leftPinkyFingerFirstJointToSecondJoint:\n        leftHandLandmarks === undefined || leftHandLandmarks.length === 0\n          ? null\n          : [\n              leftHandLandmarks[19].x - leftHandLandmarks[18].x,\n              leftHandLandmarks[19].y - leftHandLandmarks[18].y,\n              leftHandLandmarks[19].z - leftHandLandmarks[18].z,\n            ],\n    };\n  }\n\n  /**\n   * BodyVector 間が類似しているかどうかの判定\n   * @param bodyVectorA 比較先の BodyVector\n   * @param bodyVectorB 比較元の BodyVector\n   * @param threshold しきい値\n   * @returns 類似しているかどうか\n   */\n  static isSimilarBodyPose(\n    bodyVectorA: BodyVector,\n    bodyVectorB: BodyVector,\n    threshold = 0.8\n  ): boolean {\n    let isSimilar = false;\n    const similarity = PoseSet.getBodyPoseSimilarity(bodyVectorA, bodyVectorB);\n    if (similarity >= threshold) isSimilar = true;\n\n    // console.debug(`[PoseSet] isSimilarPose`, isSimilar, similarity);\n\n    return isSimilar;\n  }\n\n  /**\n   * 身体ポーズの類似度の取得\n   * @param bodyVectorA 比較先の BodyVector\n   * @param bodyVectorB 比較元の BodyVector\n   * @returns 類似度\n   */\n  static getBodyPoseSimilarity(\n    bodyVectorA: BodyVector,\n    bodyVectorB: BodyVector\n  ): number {\n    const cosSimilarities = {\n      leftWristToLeftElbow: PoseSet.getCosSimilarity(\n        bodyVectorA.leftWristToLeftElbow,\n        bodyVectorB.leftWristToLeftElbow\n      ),\n      leftElbowToLeftShoulder: PoseSet.getCosSimilarity(\n        bodyVectorA.leftElbowToLeftShoulder,\n        bodyVectorB.leftElbowToLeftShoulder\n      ),\n      rightWristToRightElbow: PoseSet.getCosSimilarity(\n        bodyVectorA.rightWristToRightElbow,\n        bodyVectorB.rightWristToRightElbow\n      ),\n      rightElbowToRightShoulder: PoseSet.getCosSimilarity(\n        bodyVectorA.rightElbowToRightShoulder,\n        bodyVectorB.rightElbowToRightShoulder\n      ),\n    };\n\n    const cosSimilaritiesSum = Object.values(cosSimilarities).reduce(\n      (sum, value) => sum + value,\n      0\n    );\n    return cosSimilaritiesSum / Object.keys(cosSimilarities).length;\n  }\n\n  /**\n   * HandVector 間が類似しているかどうかの判定\n   * @param handVectorA 比較先の HandVector\n   * @param handVectorB 比較元の HandVector\n   * @param threshold しきい値\n   * @returns 類似しているかどうか\n   */\n  static isSimilarHandPose(\n    handVectorA: HandVector,\n    handVectorB: HandVector,\n    threshold = 0.75\n  ): boolean {\n    const similarity = PoseSet.getHandSimilarity(handVectorA, handVectorB);\n    if (similarity === -1) {\n      return true;\n    }\n    return similarity >= threshold;\n  }\n\n  /**\n   * 手のポーズの類似度の取得\n   * @param handVectorA 比較先の HandVector\n   * @param handVectorB 比較元の HandVector\n   * @returns 類似度\n   */\n  static getHandSimilarity(\n    handVectorA: HandVector,\n    handVectorB: HandVector\n  ): number {\n    const cosSimilaritiesRightHand =\n      handVectorA.rightThumbFirstJointToSecondJoint === null ||\n      handVectorB.rightThumbFirstJointToSecondJoint === null\n        ? undefined\n        : {\n            // 右手 - 親指\n            rightThumbTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightThumbTipToFirstJoint,\n              handVectorB.rightThumbTipToFirstJoint\n            ),\n            rightThumbFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightThumbFirstJointToSecondJoint,\n              handVectorB.rightThumbFirstJointToSecondJoint\n            ),\n            // 右手 - 人差し指\n            rightIndexFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightIndexFingerTipToFirstJoint,\n              handVectorB.rightIndexFingerTipToFirstJoint\n            ),\n            rightIndexFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightIndexFingerFirstJointToSecondJoint,\n              handVectorB.rightIndexFingerFirstJointToSecondJoint\n            ),\n            // 右手 - 中指\n            rightMiddleFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightMiddleFingerTipToFirstJoint,\n              handVectorB.rightMiddleFingerTipToFirstJoint\n            ),\n            rightMiddleFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightMiddleFingerFirstJointToSecondJoint,\n              handVectorB.rightMiddleFingerFirstJointToSecondJoint\n            ),\n            // 右手 - 薬指\n            rightRingFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightRingFingerTipToFirstJoint,\n              handVectorB.rightRingFingerFirstJointToSecondJoint\n            ),\n            rightRingFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightRingFingerFirstJointToSecondJoint,\n              handVectorB.rightRingFingerFirstJointToSecondJoint\n            ),\n            // 右手 - 小指\n            rightPinkyFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightPinkyFingerTipToFirstJoint,\n              handVectorB.rightPinkyFingerTipToFirstJoint\n            ),\n            rightPinkyFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.rightPinkyFingerFirstJointToSecondJoint,\n              handVectorB.rightPinkyFingerFirstJointToSecondJoint\n            ),\n          };\n\n    const cosSimilaritiesLeftHand =\n      handVectorA.leftThumbFirstJointToSecondJoint === null ||\n      handVectorB.leftThumbFirstJointToSecondJoint === null\n        ? undefined\n        : {\n            // 左手 - 親指\n            leftThumbTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftThumbTipToFirstJoint,\n              handVectorB.leftThumbTipToFirstJoint\n            ),\n            leftThumbFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftThumbFirstJointToSecondJoint,\n              handVectorB.leftThumbFirstJointToSecondJoint\n            ),\n            // 左手 - 人差し指\n            leftIndexFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftIndexFingerTipToFirstJoint,\n              handVectorB.leftIndexFingerTipToFirstJoint\n            ),\n            leftIndexFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftIndexFingerFirstJointToSecondJoint,\n              handVectorB.leftIndexFingerFirstJointToSecondJoint\n            ),\n            // 左手 - 中指\n            leftMiddleFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftMiddleFingerTipToFirstJoint,\n              handVectorB.leftMiddleFingerTipToFirstJoint\n            ),\n            leftMiddleFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftMiddleFingerFirstJointToSecondJoint,\n              handVectorB.leftMiddleFingerFirstJointToSecondJoint\n            ),\n            // 左手 - 薬指\n            leftRingFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftRingFingerTipToFirstJoint,\n              handVectorB.leftRingFingerTipToFirstJoint\n            ),\n            leftRingFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftRingFingerFirstJointToSecondJoint,\n              handVectorB.leftRingFingerFirstJointToSecondJoint\n            ),\n            // 左手 - 小指\n            leftPinkyFingerTipToFirstJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftPinkyFingerTipToFirstJoint,\n              handVectorB.leftPinkyFingerTipToFirstJoint\n            ),\n            leftPinkyFingerFirstJointToSecondJoint: PoseSet.getCosSimilarity(\n              handVectorA.leftPinkyFingerFirstJointToSecondJoint,\n              handVectorB.leftPinkyFingerFirstJointToSecondJoint\n            ),\n          };\n\n    // 左手の類似度\n    let cosSimilaritiesSumLeftHand = 0;\n    if (cosSimilaritiesLeftHand) {\n      cosSimilaritiesSumLeftHand = Object.values(\n        cosSimilaritiesLeftHand\n      ).reduce((sum, value) => sum + value, 0);\n    }\n\n    // 右手の類似度\n    let cosSimilaritiesSumRightHand = 0;\n    if (cosSimilaritiesRightHand) {\n      cosSimilaritiesSumRightHand = Object.values(\n        cosSimilaritiesRightHand\n      ).reduce((sum, value) => sum + value, 0);\n    }\n\n    // 合算された類似度\n    if (cosSimilaritiesRightHand && cosSimilaritiesLeftHand) {\n      return (\n        (cosSimilaritiesSumRightHand + cosSimilaritiesSumLeftHand) /\n        (Object.keys(cosSimilaritiesRightHand!).length +\n          Object.keys(cosSimilaritiesLeftHand!).length)\n      );\n    } else if (cosSimilaritiesRightHand) {\n      if (\n        handVectorB.leftThumbFirstJointToSecondJoint !== null &&\n        handVectorA.leftThumbFirstJointToSecondJoint === null\n      ) {\n        // handVectorB で左手があるのに handVectorA で左手がない場合、類似度を減らす\n        console.debug(\n          `[PoseSet] getHandSimilarity - Adjust similarity, because left hand not found...`\n        );\n        return (\n          cosSimilaritiesSumRightHand /\n          (Object.keys(cosSimilaritiesRightHand!).length * 2)\n        );\n      }\n      return (\n        cosSimilaritiesSumRightHand /\n        Object.keys(cosSimilaritiesRightHand!).length\n      );\n    } else if (cosSimilaritiesLeftHand) {\n      if (\n        handVectorB.rightThumbFirstJointToSecondJoint !== null &&\n        handVectorA.rightThumbFirstJointToSecondJoint === null\n      ) {\n        // handVectorB で右手があるのに handVectorA で右手がない場合、類似度を減らす\n        console.debug(\n          `[PoseSet] getHandSimilarity - Adjust similarity, because right hand not found...`\n        );\n        return (\n          cosSimilaritiesSumLeftHand /\n          (Object.keys(cosSimilaritiesLeftHand!).length * 2)\n        );\n      }\n      return (\n        cosSimilaritiesSumLeftHand /\n        Object.keys(cosSimilaritiesLeftHand!).length\n      );\n    }\n\n    return -1;\n  }\n\n  /**\n   * ZIP ファイルとしてのシリアライズ\n   * @returns ZIPファイル (Blob 形式)\n   */\n  public async getZip(): Promise<Blob> {\n    const jsZip = new JSZip();\n    jsZip.file('poses.json', await this.getJson());\n\n    const imageFileExt = this.getFileExtensionByMime(this.IMAGE_MIME);\n\n    for (const pose of this.poses) {\n      if (pose.frameImageDataUrl) {\n        try {\n          const index =\n            pose.frameImageDataUrl.indexOf('base64,') + 'base64,'.length;\n          const base64 = pose.frameImageDataUrl.substring(index);\n          jsZip.file(`frame-${pose.id}.${imageFileExt}`, base64, {\n            base64: true,\n          });\n        } catch (error) {\n          console.warn(\n            `[PoseExporterService] push - Could not push frame image`,\n            error\n          );\n          throw error;\n        }\n      }\n      if (pose.poseImageDataUrl) {\n        try {\n          const index =\n            pose.poseImageDataUrl.indexOf('base64,') + 'base64,'.length;\n          const base64 = pose.poseImageDataUrl.substring(index);\n          jsZip.file(`pose-${pose.id}.${imageFileExt}`, base64, {\n            base64: true,\n          });\n        } catch (error) {\n          console.warn(\n            `[PoseExporterService] push - Could not push frame image`,\n            error\n          );\n          throw error;\n        }\n      }\n      if (pose.faceFrameImageDataUrl) {\n        try {\n          const index =\n            pose.faceFrameImageDataUrl.indexOf('base64,') + 'base64,'.length;\n          const base64 = pose.faceFrameImageDataUrl.substring(index);\n          jsZip.file(`face-${pose.id}.${imageFileExt}`, base64, {\n            base64: true,\n          });\n        } catch (error) {\n          console.warn(\n            `[PoseExporterService] push - Could not push face frame image`,\n            error\n          );\n          throw error;\n        }\n      }\n    }\n\n    return await jsZip.generateAsync({ type: 'blob' });\n  }\n\n  /**\n   * JSON 文字列としてのシリアライズ\n   * @returns JSON 文字列\n   */\n  public async getJson(): Promise<string> {\n    if (this.videoMetadata === undefined || this.poses === undefined)\n      return '{}';\n\n    if (!this.isFinalized) {\n      await this.finalize();\n    }\n\n    let poseLandmarkMappings = [];\n    for (const key of Object.keys(POSE_LANDMARKS)) {\n      const index: number = POSE_LANDMARKS[key as keyof typeof POSE_LANDMARKS];\n      poseLandmarkMappings[index] = key;\n    }\n\n    const json: PoseSetJson = {\n      generator: 'mp-video-pose-extractor',\n      version: 1,\n      video: this.videoMetadata!,\n      poses: this.poses.map((pose: PoseSetItem): PoseSetJsonItem => {\n        // BodyVector の圧縮\n        const bodyVector = [];\n        for (const key of PoseSet.BODY_VECTOR_MAPPINGS) {\n          bodyVector.push(pose.bodyVector[key as keyof BodyVector]);\n        }\n\n        // HandVector の圧縮\n        let handVector: (number[] | null)[] | undefined = undefined;\n        if (pose.handVector) {\n          handVector = [];\n          for (const key of PoseSet.HAND_VECTOR_MAPPINGS) {\n            handVector.push(pose.handVector[key as keyof HandVector]);\n          }\n        }\n\n        // PoseSetJsonItem の pose オブジェクトを生成\n        return {\n          id: pose.id,\n          t: pose.timeMiliseconds,\n          d: pose.durationMiliseconds,\n          p: pose.pose,\n          l: pose.leftHand,\n          r: pose.rightHand,\n          v: bodyVector,\n          h: handVector,\n          e: pose.extendedData,\n          md: pose.mergedDurationMiliseconds,\n          mt: pose.mergedTimeMiliseconds,\n        };\n      }),\n      poseLandmarkMapppings: poseLandmarkMappings,\n    };\n\n    return JSON.stringify(json);\n  }\n\n  /**\n   * JSON からの読み込み\n   * @param json JSON 文字列 または JSON オブジェクト\n   */\n  loadJson(json: string | any) {\n    const parsedJson = typeof json === 'string' ? JSON.parse(json) : json;\n\n    if (parsedJson.generator !== 'mp-video-pose-extractor') {\n      throw '不正なファイル';\n    } else if (parsedJson.version !== 1) {\n      throw '未対応のバージョン';\n    }\n\n    this.videoMetadata = parsedJson.video;\n    this.poses = parsedJson.poses.map((item: PoseSetJsonItem): PoseSetItem => {\n      const bodyVector: any = {};\n      PoseSet.BODY_VECTOR_MAPPINGS.map((key, index) => {\n        bodyVector[key as keyof BodyVector] = item.v[index];\n      });\n\n      const handVector: any = {};\n      if (item.h) {\n        PoseSet.HAND_VECTOR_MAPPINGS.map((key, index) => {\n          handVector[key as keyof HandVector] = item.h![index];\n        });\n      }\n\n      return {\n        id:\n          item.id === undefined\n            ? PoseSet.getIdByTimeMiliseconds(item.t)\n            : item.id,\n        timeMiliseconds: item.t,\n        durationMiliseconds: item.d,\n        pose: item.p,\n        leftHand: item.l,\n        rightHand: item.r,\n        bodyVector: bodyVector,\n        handVector: handVector,\n        frameImageDataUrl: undefined,\n        extendedData: item.e,\n        debug: undefined,\n        mergedDurationMiliseconds: item.md,\n        mergedTimeMiliseconds: item.mt,\n      };\n    });\n  }\n\n  /**\n   * ZIP ファイルからの読み込み\n   * @param buffer ZIP ファイルの Buffer\n   * @param includeImages 画像を展開するかどうか\n   */\n  async loadZip(buffer: ArrayBuffer, includeImages: boolean = true) {\n    const jsZip = new JSZip();\n    console.debug(`[PoseSet] init...`);\n    const zip = await jsZip.loadAsync(buffer, { base64: false });\n    if (!zip) throw 'ZIPファイルを読み込めませんでした';\n\n    const json = await zip.file('poses.json')?.async('text');\n    if (json === undefined) {\n      throw 'ZIPファイルに pose.json が含まれていません';\n    }\n\n    this.loadJson(json);\n\n    const fileExt = this.getFileExtensionByMime(this.IMAGE_MIME);\n\n    if (includeImages) {\n      for (const pose of this.poses) {\n        if (!pose.frameImageDataUrl) {\n          let imageBase64: string;\n          if (zip.file(`frame-${pose.id}.${fileExt}`)) {\n            imageBase64 = await zip\n              .file(`frame-${pose.id}.${fileExt}`)\n              ?.async('base64');\n          } else {\n            imageBase64 = await zip\n              .file(`frame-${pose.timeMiliseconds}.${fileExt}`)\n              ?.async('base64');\n          }\n          if (imageBase64) {\n            pose.frameImageDataUrl = `data:${this.IMAGE_MIME};base64,${imageBase64}`;\n          }\n        }\n        if (!pose.poseImageDataUrl) {\n          const poseImageFileName = `pose-${pose.id}.${fileExt}`;\n          const imageBase64 = await zip\n            .file(poseImageFileName)\n            ?.async('base64');\n          if (imageBase64) {\n            pose.poseImageDataUrl = `data:${this.IMAGE_MIME};base64,${imageBase64}`;\n          }\n        }\n      }\n    }\n  }\n\n  static getCosSimilarity(a: number[], b: number[]) {\n    if (cosSimilarityA) {\n      return cosSimilarityA(a, b);\n    }\n    return cosSimilarityB(a, b);\n  }\n\n  private pushPoseFromSimilarPoseQueue(nextPoseTimeMiliseconds?: number) {\n    if (this.similarPoseQueue.length === 0) return;\n\n    if (this.similarPoseQueue.length === 1) {\n      // 類似ポーズキューにポーズが一つしかない場合、当該ポーズをポーズ配列へ追加\n      const pose = this.similarPoseQueue[0];\n      this.poses.push(pose);\n      this.similarPoseQueue = [];\n      return;\n    }\n\n    // 各ポーズの持続時間を設定\n    for (let i = 0; i < this.similarPoseQueue.length - 1; i++) {\n      this.similarPoseQueue[i].durationMiliseconds =\n        this.similarPoseQueue[i + 1].timeMiliseconds -\n        this.similarPoseQueue[i].timeMiliseconds;\n    }\n    if (nextPoseTimeMiliseconds) {\n      this.similarPoseQueue[\n        this.similarPoseQueue.length - 1\n      ].durationMiliseconds =\n        nextPoseTimeMiliseconds -\n        this.similarPoseQueue[this.similarPoseQueue.length - 1].timeMiliseconds;\n    }\n\n    // 類似ポーズキューの中から最も持続時間が長いポーズを選択\n    const selectedPose = PoseSet.getSuitablePoseByPoses(this.similarPoseQueue);\n\n    // 選択されなかったポーズを列挙\n    selectedPose.debug.duplicatedItems = this.similarPoseQueue\n      .filter((item: PoseSetItem) => {\n        return item.timeMiliseconds !== selectedPose.timeMiliseconds;\n      })\n      .map((item: PoseSetItem) => {\n        return {\n          id: item.id,\n          timeMiliseconds: item.timeMiliseconds,\n          durationMiliseconds: item.durationMiliseconds,\n        };\n      });\n\n    // 選択されたポーズの情報を更新\n    selectedPose.mergedTimeMiliseconds =\n      this.similarPoseQueue[0].timeMiliseconds;\n    selectedPose.mergedDurationMiliseconds = this.similarPoseQueue.reduce(\n      (sum: number, item: PoseSetItem) => {\n        return sum + item.durationMiliseconds;\n      },\n      0\n    );\n    selectedPose.id = PoseSet.getIdByTimeMiliseconds(\n      selectedPose.mergedTimeMiliseconds\n    );\n\n    // 当該ポーズをポーズ配列へ追加\n    if (this.IS_ENABLED_REMOVE_DUPLICATED_POSES_FOR_AROUND) {\n      this.poses.push(selectedPose);\n    } else {\n      // デバッグ用\n      this.poses.push(...this.similarPoseQueue);\n    }\n\n    // 類似ポーズキューをクリア\n    this.similarPoseQueue = [];\n  }\n\n  removeDuplicatedPoses(): void {\n    // 全ポーズを比較して類似ポーズを削除\n    const newPoses: PoseSetItem[] = [],\n      removedPoses: PoseSetItem[] = [];\n    for (const pose of this.poses) {\n      let duplicatedPose: PoseSetItem;\n      for (const insertedPose of newPoses) {\n        const isSimilarBodyPose = PoseSet.isSimilarBodyPose(\n          pose.bodyVector,\n          insertedPose.bodyVector\n        );\n        const isSimilarHandPose =\n          pose.handVector && insertedPose.handVector\n            ? PoseSet.isSimilarHandPose(\n                pose.handVector,\n                insertedPose.handVector,\n                0.9\n              )\n            : false;\n\n        if (isSimilarBodyPose && isSimilarHandPose) {\n          // 身体・手ともに類似ポーズならば\n          duplicatedPose = insertedPose;\n          break;\n        }\n      }\n\n      if (duplicatedPose) {\n        removedPoses.push(pose);\n        if (duplicatedPose.debug.duplicatedItems) {\n          duplicatedPose.debug.duplicatedItems.push({\n            id: pose.id,\n            timeMiliseconds: pose.timeMiliseconds,\n            durationMiliseconds: pose.durationMiliseconds,\n          });\n        }\n        continue;\n      }\n\n      newPoses.push(pose);\n    }\n\n    console.info(\n      `[PoseSet] removeDuplicatedPoses - Reduced ${this.poses.length} poses -> ${newPoses.length} poses`,\n      {\n        removed: removedPoses,\n        keeped: newPoses,\n      }\n    );\n    this.poses = newPoses;\n  }\n\n  static getIdByTimeMiliseconds(timeMiliseconds: number) {\n    return Math.floor(timeMiliseconds / 100) * 100;\n  }\n\n  private getFileExtensionByMime(IMAGE_MIME: string) {\n    switch (IMAGE_MIME) {\n      case 'image/png':\n        return 'png';\n      case 'image/jpeg':\n        return 'jpg';\n      case 'image/webp':\n        return 'webp';\n      default:\n        return 'png';\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { PoseSet } from '../classes/pose-set';\n\n/**\n * ポーズを管理するためのサービス\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class PoseComposerService {\n  constructor() {}\n\n  init(videoName: string): PoseSet {\n    const poseSet = new PoseSet();\n    poseSet.setVideoName(videoName);\n    return poseSet;\n  }\n\n  async downloadAsJson(poseSet: PoseSet) {\n    const blob = new Blob([await poseSet.getJson()], {\n      type: 'application/json',\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.target = '_blank';\n    a.download = `${poseSet.getVideoName()}-poses.json`;\n    a.click();\n  }\n\n  async downloadAsZip(poseSet: PoseSet) {\n    const content = await poseSet.getZip();\n    const url = window.URL.createObjectURL(content);\n    const a = document.createElement('a');\n    a.href = url;\n    a.target = '_blank';\n    a.download = `${poseSet.getVideoName()}-poses.zip`;\n    a.click();\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport {\n  HAND_CONNECTIONS,\n  Holistic,\n  NormalizedLandmark,\n  NormalizedLandmarkList,\n  POSE_CONNECTIONS,\n  POSE_LANDMARKS,\n  POSE_LANDMARKS_LEFT,\n  POSE_LANDMARKS_RIGHT,\n  Results,\n} from '@mediapipe/holistic';\nimport { drawConnectors, drawLandmarks, lerp } from '@mediapipe/drawing_utils';\n\nexport interface OnResultsEvent {\n  mpResults: Results;\n  frameImageDataUrl: string;\n  posePreviewImageDataUrl: string;\n  faceFrameImageDataUrl?: string;\n}\n\n/**\n * MediaPipe を用いて動画からポーズを抽出するためのサービス\n *\n * ※ シングルトンなサービスではないため、Component で providers に指定して使用することを想定\n */\n@Injectable()\nexport class PoseExtractorService {\n  public onResultsEventEmitter: EventEmitter<OnResultsEvent> =\n    new EventEmitter();\n\n  private holistic?: Holistic;\n\n  private posePreviewCanvasElement?: HTMLCanvasElement;\n  private posePreviewCanvasContext?: CanvasRenderingContext2D;\n\n  private handPreviewCanvasElement?: HTMLCanvasElement;\n  private handPreviewCanvasContext?: CanvasRenderingContext2D;\n\n  private facePreviewCanvasElement?: HTMLCanvasElement;\n  private facePreviewCanvasContext?: CanvasRenderingContext2D;\n\n  constructor() {\n    this.init();\n  }\n\n  public getPosePreviewMediaStream(): MediaStream | undefined {\n    if (!this.posePreviewCanvasElement) return;\n    return this.posePreviewCanvasElement.captureStream();\n  }\n\n  public getHandPreviewMediaStream(): MediaStream | undefined {\n    if (!this.handPreviewCanvasElement) return;\n    return this.handPreviewCanvasElement.captureStream();\n  }\n\n  public getFacePreviewMediaStream(): MediaStream | undefined {\n    if (!this.facePreviewCanvasElement) return;\n    return this.facePreviewCanvasElement.captureStream();\n  }\n\n  public async onVideoFrame(input: HTMLVideoElement | HTMLCanvasElement) {\n    if (!this.holistic) return;\n\n    if (input instanceof HTMLVideoElement) {\n      if (this.posePreviewCanvasElement) {\n        this.posePreviewCanvasElement.width = input.videoWidth;\n        this.posePreviewCanvasElement.height = input.videoHeight;\n      }\n\n      if (this.handPreviewCanvasElement) {\n        this.handPreviewCanvasElement.width = input.videoWidth;\n        this.handPreviewCanvasElement.height = input.videoHeight;\n      }\n\n      if (this.facePreviewCanvasElement) {\n        this.facePreviewCanvasElement.width = input.videoWidth;\n        this.facePreviewCanvasElement.height = input.videoHeight;\n      }\n    } else if (input instanceof HTMLCanvasElement) {\n      if (this.posePreviewCanvasElement) {\n        this.posePreviewCanvasElement.width = input.width;\n        this.posePreviewCanvasElement.height = input.height;\n      }\n\n      if (this.handPreviewCanvasElement) {\n        this.handPreviewCanvasElement.width = input.width;\n        this.handPreviewCanvasElement.height = input.height;\n      }\n\n      if (this.facePreviewCanvasElement) {\n        this.facePreviewCanvasElement.width = input.width;\n        this.facePreviewCanvasElement.height = input.height;\n      }\n    }\n\n    await this.holistic.send({ image: input });\n  }\n\n  private init() {\n    this.posePreviewCanvasElement = document.createElement('canvas');\n    this.posePreviewCanvasContext =\n      this.posePreviewCanvasElement.getContext('2d') || undefined;\n\n    this.handPreviewCanvasElement = document.createElement('canvas');\n    this.handPreviewCanvasContext =\n      this.handPreviewCanvasElement.getContext('2d') || undefined;\n\n    this.facePreviewCanvasElement = document.createElement('canvas');\n    this.facePreviewCanvasContext =\n      this.facePreviewCanvasElement.getContext('2d') || undefined;\n\n    this.holistic = new Holistic({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`;\n      },\n    });\n\n    this.holistic.setOptions({\n      selfieMode: false,\n      modelComplexity: 1,\n      smoothLandmarks: true,\n      enableSegmentation: false,\n      smoothSegmentation: true,\n      minDetectionConfidence: 0.6,\n      minTrackingConfidence: 0.6,\n    });\n\n    this.holistic.onResults((results: Results) => {\n      this.onResults(results);\n    });\n  }\n\n  private onResults(results: Results) {\n    if (\n      !this.posePreviewCanvasElement ||\n      !this.posePreviewCanvasContext ||\n      !this.holistic\n    )\n      return;\n\n    // 描画用に不必要なランドマークを除去\n    let poseLandmarks: NormalizedLandmarkList = [];\n    if (results.poseLandmarks) {\n      poseLandmarks = JSON.parse(\n        JSON.stringify(results.poseLandmarks)\n      ) as NormalizedLandmarkList;\n      this.removeElements(\n        poseLandmarks,\n        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 16, 17, 18, 19, 20, 21, 22]\n      );\n    }\n\n    // キャンバスを塗りつぶし\n    this.posePreviewCanvasContext.save();\n    this.posePreviewCanvasContext.clearRect(\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 検出に使用したフレーム画像を描画\n    this.posePreviewCanvasContext.drawImage(\n      results.image,\n      0,\n      0,\n      this.posePreviewCanvasElement.width,\n      this.posePreviewCanvasElement.height\n    );\n\n    // 検出に使用したフレーム画像を保持 (加工されていない画像)\n    const sourceImageDataUrl =\n      this.posePreviewCanvasElement.toDataURL('image/png');\n\n    // 肘と手をつなぐ線を描画\n    this.posePreviewCanvasContext.lineWidth = 5;\n    if (poseLandmarks) {\n      if (results.rightHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.RIGHT_ELBOW],\n            results.rightHandLandmarks[0],\n          ],\n        ]);\n      }\n      if (results.leftHandLandmarks) {\n        this.posePreviewCanvasContext.strokeStyle = 'white';\n        this.connect(this.posePreviewCanvasContext, [\n          [\n            poseLandmarks[POSE_LANDMARKS.LEFT_ELBOW],\n            results.leftHandLandmarks[0],\n          ],\n        ]);\n      }\n    }\n\n    // ポーズのプレビューを描画\n    if (poseLandmarks) {\n      drawConnectors(\n        this.posePreviewCanvasContext,\n        poseLandmarks,\n        POSE_CONNECTIONS,\n        { color: 'white' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_LEFT).map((index) => poseLandmarks[index]),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(255,138,0)' }\n      );\n      drawLandmarks(\n        this.posePreviewCanvasContext,\n        Object.values(POSE_LANDMARKS_RIGHT).map(\n          (index) => poseLandmarks[index]\n        ),\n        { visibilityMin: 0.65, color: 'white', fillColor: 'rgb(0,217,231)' }\n      );\n    }\n\n    // 手のプレビューを描画\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.rightHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.rightHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(0,217,231)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n    drawConnectors(\n      this.posePreviewCanvasContext,\n      results.leftHandLandmarks,\n      HAND_CONNECTIONS,\n      { color: 'white' }\n    );\n    drawLandmarks(this.posePreviewCanvasContext, results.leftHandLandmarks, {\n      color: 'white',\n      fillColor: 'rgb(255,138,0)',\n      lineWidth: 2,\n      radius: (data: any) => {\n        return lerp(data.from.z, -0.15, 0.1, 10, 1);\n      },\n    });\n\n    // 手の領域のみのプレビュー画像を生成\n    if (this.handPreviewCanvasContext && this.handPreviewCanvasElement) {\n      const HAND_PREVIEW_ZOOM = 3;\n      const handPreviewBaseY = this.handPreviewCanvasElement.height / 2;\n\n      this.handPreviewCanvasContext.clearRect(\n        0,\n        0,\n        this.handPreviewCanvasElement.width,\n        this.handPreviewCanvasElement.height\n      );\n\n      if (results.rightHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.rightHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX = 0;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n\n      if (results.leftHandLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.leftHandLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        let handPreviewX =\n          this.handPreviewCanvasElement.width - rect[2] * HAND_PREVIEW_ZOOM;\n        let handPreviewY = handPreviewBaseY - (rect[3] * HAND_PREVIEW_ZOOM) / 2;\n\n        this.handPreviewCanvasContext.drawImage(\n          this.posePreviewCanvasElement,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          handPreviewX,\n          handPreviewY,\n          rect[2] * HAND_PREVIEW_ZOOM,\n          rect[3] * HAND_PREVIEW_ZOOM\n        );\n      }\n    }\n\n    // 顔の領域のみのフレーム画像を生成\n    if (this.facePreviewCanvasContext && this.facePreviewCanvasElement) {\n      const FACE_PREVIEW_ZOOM = 1.25;\n      const facePreviewBaseY = this.facePreviewCanvasElement.height / 2;\n\n      if (results.faceLandmarks) {\n        const rect = this.getRectByLandmarks(\n          results.faceLandmarks,\n          results.image.width,\n          results.image.height\n        );\n\n        const rectWidth = rect[2] * FACE_PREVIEW_ZOOM;\n        const rectHeight = rect[3] * FACE_PREVIEW_ZOOM;\n\n        this.facePreviewCanvasElement.width = rectWidth;\n        this.facePreviewCanvasElement.height = rectHeight;\n\n        this.facePreviewCanvasContext.clearRect(0, 0, rectWidth, rectHeight);\n\n        this.facePreviewCanvasContext.drawImage(\n          results.image,\n          rect[0] - 10,\n          rect[1] - 10,\n          rect[2] + 10,\n          rect[3] + 10,\n          0,\n          0,\n          rectWidth,\n          rectHeight\n        );\n      } else {\n        this.facePreviewCanvasContext.clearRect(\n          0,\n          0,\n          this.facePreviewCanvasElement.width,\n          this.facePreviewCanvasElement.height\n        );\n      }\n    }\n\n    // イベントを送出\n    this.onResultsEventEmitter.emit({\n      mpResults: results,\n      // 加工されていない画像 (PNG)\n      frameImageDataUrl: sourceImageDataUrl,\n      // 加工された画像 (PNG)\n      posePreviewImageDataUrl:\n        this.posePreviewCanvasElement.toDataURL('image/png'),\n      // 顔のみの画像 (PNG)\n      faceFrameImageDataUrl: results.faceLandmarks\n        ? this.facePreviewCanvasElement!.toDataURL('image/png')\n        : undefined,\n    });\n\n    // 完了\n    this.posePreviewCanvasContext.restore();\n  }\n\n  private connect(\n    ctx: CanvasRenderingContext2D,\n    connectors: Array<[NormalizedLandmark, NormalizedLandmark]>\n  ) {\n    const canvas = ctx.canvas;\n    for (const connector of connectors) {\n      const from = connector[0];\n      const to = connector[1];\n      if (from && to) {\n        if (\n          from.visibility &&\n          to.visibility &&\n          (from.visibility < 0.1 || to.visibility < 0.1)\n        ) {\n          continue;\n        }\n        ctx.beginPath();\n        ctx.moveTo(from.x * canvas.width, from.y * canvas.height);\n        ctx.lineTo(to.x * canvas.width, to.y * canvas.height);\n        ctx.stroke();\n      }\n    }\n  }\n\n  private removeElements(\n    landmarks: NormalizedLandmarkList,\n    elements: number[]\n  ) {\n    for (const element of elements) {\n      delete landmarks[element];\n    }\n  }\n\n  private getRectByLandmarks(landmarks: any[], width: number, height: number) {\n    const leftHandLandmarksX = landmarks.map((landmark) => landmark.x * width);\n    const leftHandLandmarksY = landmarks.map((landmark) => landmark.y * height);\n    const minX = Math.min(...leftHandLandmarksX);\n    const maxX = Math.max(...leftHandLandmarksX);\n    const minY = Math.min(...leftHandLandmarksY);\n    const maxY = Math.max(...leftHandLandmarksY);\n    return [minX, minY, maxX - minX, maxY - minY];\n  }\n}\n","/*\n * Public API Surface of ngx-mp-pose-extractor\n */\n\nexport * from './lib/ngx-mp-pose-extractor.service';\nexport * from './lib/ngx-mp-pose-extractor.component';\nexport * from './lib/ngx-mp-pose-extractor.module';\n\nexport * from './lib/interfaces/body-vector';\nexport * from './lib/interfaces/pose-set-item';\nexport * from './lib/interfaces/pose-set-json-item';\nexport * from './lib/interfaces/pose-set-json';\n\nexport * from './lib/classes/pose-set';\n\nexport * from './lib/services/pose-composer.service';\nexport * from './lib/services/pose-extractor.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["cosSimilarityA","cosSimilarityB"],"mappings":";;;;;;;;MAKa,yBAAyB,CAAA;AAEpC,IAAA,WAAA,GAAA,GAAiB;;sHAFN,yBAAyB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAzB,yBAAA,CAAA,KAAA,GAAA,EAAA,CAAA,qBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,yBAAyB,cAFxB,MAAM,EAAA,CAAA,CAAA;2FAEP,yBAAyB,EAAA,UAAA,EAAA,CAAA;kBAHrC,UAAU;AAAC,YAAA,IAAA,EAAA,CAAA;AACV,oBAAA,UAAU,EAAE,MAAM;AACnB,iBAAA,CAAA;;;MCQY,2BAA2B,CAAA;;wHAA3B,2BAA2B,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAA3B,2BAAA,CAAA,IAAA,GAAA,EAAA,CAAA,oBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA,2BAA2B,EAR5B,QAAA,EAAA,2BAAA,EAAA,QAAA,EAAA,EAAA,EAAA,QAAA,EAAA,CAAA;;;;AAIT,EAAA,CAAA,EAAA,QAAA,EAAA,IAAA,EAAA,CAAA,CAAA;2FAIU,2BAA2B,EAAA,UAAA,EAAA,CAAA;kBAVvC,SAAS;AACE,YAAA,IAAA,EAAA,CAAA,EAAA,QAAA,EAAA,2BAA2B,EAC3B,QAAA,EAAA,CAAA;;;;AAIT,EAAA,CAAA,EAAA,CAAA;;;MCAU,wBAAwB,CAAA;;qHAAxB,wBAAwB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,QAAA,EAAA,CAAA,CAAA;sHAAxB,wBAAwB,EAAA,YAAA,EAAA,CAJpB,2BAA2B,CAAA,EAAA,OAAA,EAAA,CAEhC,2BAA2B,CAAA,EAAA,CAAA,CAAA;sHAE1B,wBAAwB,EAAA,CAAA,CAAA;2FAAxB,wBAAwB,EAAA,UAAA,EAAA,CAAA;kBALpC,QAAQ;AAAC,YAAA,IAAA,EAAA,CAAA;oBACR,YAAY,EAAE,CAAC,2BAA2B,CAAC;AAC3C,oBAAA,OAAO,EAAE,EAAE;oBACX,OAAO,EAAE,CAAC,2BAA2B,CAAC;AACvC,iBAAA,CAAA;;;MCLY,YAAY,CAAA;AAIvB,IAAA,WAAA,GAAA,GAAgB;IAEhB,MAAM,aAAa,CAAC,OAAe,EAAA;QACjC,MAAM,KAAK,GAAqB,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAI;AACpE,YAAA,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;AAC1B,YAAA,KAAK,CAAC,GAAG,GAAG,OAAO,CAAC;AACpB,YAAA,KAAK,CAAC,MAAM,GAAG,MAAK;gBAClB,OAAO,CAAC,KAAK,CAAC,CAAC;AACjB,aAAC,CAAC;AACJ,SAAC,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAE,CAAC;AACzC,QAAA,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;AAC3B,QAAA,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QAC7B,OAAO,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAE/B,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;KACxB;AAED,IAAA,MAAM,UAAU,CAAC,WAAmB,EAAE,gBAAwB,EAAE,EAAA;AAC9D,QAAA,IAAI,IAAI,CAAC,MAAM,KAAK,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;;QAGtE,MAAM,sBAAsB,GAAG,CAAC,CAAC;AACjC,QAAA,MAAM,sBAAsB,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC;;AAGnE,QAAA,MAAM,mBAAmB,GAAG,MAAM,IAAI,CAAC,8BAA8B,CACnE,WAAW,EACX,KAAK,EACL,aAAa,EACb,sBAAsB,EACtB,sBAAsB,CACvB,CAAC;AACF,QAAA,MAAM,SAAS,GAAG,mBAAmB,IAAI,IAAI,GAAG,mBAAmB,GAAG,CAAC,CAAC;AAExE,QAAA,MAAM,sBAAsB,GAAG,MAAM,IAAI,CAAC,8BAA8B,CACtE,WAAW,EACX,QAAQ,EACR,aAAa,EACb,sBAAsB,EACtB,sBAAsB,CACvB,CAAC;AACF,QAAA,MAAM,YAAY,GAChB,sBAAsB,IAAI,IAAI;AAC5B,cAAE,sBAAsB;AACxB,cAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AAEzB,QAAA,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AACrC,QAAA,MAAM,SAAS,GAAG,YAAY,GAAG,SAAS,CAAC;AAC3C,QAAA,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAEtD,OAAO;AACL,YAAA,SAAS,EAAE,SAAS;AACpB,YAAA,YAAY,EAAE,YAAY;AAC1B,YAAA,SAAS,EAAE,SAAS;AACpB,YAAA,SAAS,EAAE,SAAS;AACpB,YAAA,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK;SACzB,CAAC;KACH;IAED,MAAM,IAAI,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAA;QACnD,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO;QAE1C,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACnD,MAAM,UAAU,GAAG,SAAS,CAAC,UAAU,CAAC,IAAI,CAAE,CAAC;AAC/C,QAAA,SAAS,CAAC,KAAK,GAAG,CAAC,CAAC;AACpB,QAAA,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;AACrB,QAAA,UAAU,CAAC,SAAS,CAClB,IAAI,CAAC,MAAM,EACX,CAAC,EACD,CAAC,EACD,SAAS,CAAC,KAAK,EACf,SAAS,CAAC,MAAM,EAChB,CAAC,EACD,CAAC,EACD,SAAS,CAAC,KAAK,EACf,SAAS,CAAC,MAAM,CACjB,CAAC;AACF,QAAA,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;KAC/B;AAED,IAAA,MAAM,YAAY,CAChB,QAAgB,EAChB,QAAgB,EAChB,aAAqB,EAAA;QAErB,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO;YAAE,OAAO;QAE1C,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CACzC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,MAAM,CAAC,KAAK,EACjB,IAAI,CAAC,MAAM,CAAC,MAAM,CACnB,CAAC;QAEF,MAAM,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAC;AAExD,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;AACxC,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzC,gBAAA,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,CAAC;gBAC1C,MAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACpC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACtC,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACrC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;AAEtC,gBAAA,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBAC3D,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,SAAS,EAAE,aAAa,CAAC,EAAE;oBAC5D,SAAS;AACV,iBAAA;gBAED,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC;gBAC1C,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC;gBAC1C,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC;AAC1C,gBAAA,IAAI,aAAa,CAAC,CAAC,KAAK,SAAS,EAAE;oBACjC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC;AAC3C,iBAAA;AACF,aAAA;AACF,SAAA;QAED,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;KAC5C;AAED,IAAA,MAAM,cAAc,GAAA;QAClB,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACjC,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;QACD,IAAI,WAAW,GAAkB,IAAI,CAAC;QAEtC,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CACzC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,MAAM,CAAC,KAAK,EACjB,IAAI,CAAC,MAAM,CAAC,MAAM,CACnB,CAAC;QAEF,IAAI,OAAO,GAAG,KAAK,CAAC;AACpB,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE;AACpD,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzC,gBAAA,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,CAAC;gBAC1C,MAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACpC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACtC,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBACrC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;AAEtC,gBAAA,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBAC3D,IAAI,WAAW,IAAI,SAAS,EAAE;oBAC5B,IAAI,WAAW,KAAK,IAAI,EAAE;wBACxB,WAAW,GAAG,SAAS,CAAC;AACzB,qBAAA;AAAM,yBAAA;wBACL,OAAO,GAAG,IAAI,CAAC;wBACf,MAAM;AACP,qBAAA;AACF,iBAAA;AACF,aAAA;AACF,SAAA;AAED,QAAA,OAAO,WAAW,CAAC;KACpB;IAED,MAAM,8BAA8B,CAClC,KAAa,EACb,SAA2B,EAC3B,aAAqB,EACrB,IAAa,EACb,IAAa,EAAA;QAEb,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACjC,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;QAED,IAAI,IAAI,KAAK,SAAS,EAAE;YACtB,IAAI,GAAG,CAAC,CAAC;AACV,SAAA;QACD,IAAI,IAAI,KAAK,SAAS,EAAE;AACtB,YAAA,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;AAC1B,SAAA;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CACzC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,MAAM,CAAC,KAAK,EACjB,IAAI,CAAC,MAAM,CAAC,MAAM,CACnB,CAAC;QAEF,IAAI,OAAO,GAAG,KAAK,CAAC;AAEpB,QAAA,IAAI,aAAa,CAAC;QAClB,IAAI,SAAS,KAAK,KAAK,EAAE;YACvB,aAAa,GAAG,CAAC,CAAC;AAElB,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzC,gBAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE;AACzC,oBAAA,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,CAAC;oBAC1C,MAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACpC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACtC,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACrC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;AAEtC,oBAAA,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;oBAC3D,IACE,KAAK,IAAI,SAAS;wBAClB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,SAAS,EAAE,aAAa,CAAC,EACpD;wBACA,IAAI,aAAa,GAAG,CAAC,EAAE;4BACrB,aAAa,GAAG,CAAC,CAAC;AACnB,yBAAA;AACF,qBAAA;AAAM,yBAAA;wBACL,OAAO,GAAG,IAAI,CAAC;wBACf,MAAM;AACP,qBAAA;AACF,iBAAA;AACF,aAAA;YAED,IAAI,aAAa,KAAK,CAAC,EAAE;gBACvB,aAAa,IAAI,CAAC,CAAC;AACpB,aAAA;AACF,SAAA;aAAM,IAAI,SAAS,KAAK,QAAQ,EAAE;AACjC,YAAA,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AAEnC,YAAA,KAAK,IAAI,CAAC,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AAC9C,gBAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE;AACpD,oBAAA,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,IAAI,CAAC,CAAC;oBAC1C,MAAM,GAAG,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACpC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACtC,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;oBACrC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;AAEtC,oBAAA,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;oBAC3D,IACE,KAAK,IAAI,SAAS;wBAClB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,SAAS,EAAE,aAAa,CAAC,EACpD;wBACA,IAAI,aAAa,GAAG,CAAC,EAAE;4BACrB,aAAa,GAAG,CAAC,CAAC;AACnB,yBAAA;AACF,qBAAA;AAAM,yBAAA;wBACL,OAAO,GAAG,IAAI,CAAC;wBACf,MAAM;AACP,qBAAA;AACF,iBAAA;AACF,aAAA;AAED,YAAA,IAAI,aAAa,KAAK,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;gBACxC,aAAa,IAAI,CAAC,CAAC;AACpB,aAAA;AACF,SAAA;AAED,QAAA,OAAO,aAAa,CAAC;KACtB;AAED,IAAA,MAAM,QAAQ,GAAA;AACZ,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC;KAC3B;AAED,IAAA,MAAM,SAAS,GAAA;AACb,QAAA,OAAO,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC;KAC5B;IAED,MAAM,aAAa,CAAC,KAA0C,EAAA;AAC5D,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAChB,OAAO;AACR,SAAA;AAED,QAAA,IAAI,QAAQ,GAAW,CAAC,EACtB,SAAS,GAAW,CAAC,CAAC;AACxB,QAAA,IAAI,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE;AAClD,YAAA,QAAQ,GAAG,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;AACzD,YAAA,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACjE,SAAA;AAAM,aAAA,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE;AAC5D,YAAA,SAAS,GAAG,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AAC7D,YAAA,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AACjE,SAAA;AAAM,aAAA;YACL,OAAO;AACR,SAAA;QAED,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACnD,MAAM,UAAU,GAAG,SAAS,CAAC,UAAU,CAAC,IAAI,CAAE,CAAC;AAC/C,QAAA,SAAS,CAAC,KAAK,GAAG,QAAQ,CAAC;AAC3B,QAAA,SAAS,CAAC,MAAM,GAAG,SAAS,CAAC;AAC7B,QAAA,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;AAC7D,QAAA,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;KAC/B;AAEO,IAAA,aAAa,CAAC,MAAyB,EAAA;QAC7C,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACjC,YAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAE,CAAC;YAC7C,OAAO;AACR,SAAA;AAED,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;AACtB,QAAA,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;QACvB,OAAO,IAAI,CAAC,MAAM,CAAC;QACnB,OAAO,IAAI,CAAC,OAAO,CAAC;AAEpB,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAE,CAAC;KAC9C;AAED,IAAA,MAAM,UAAU,CACd,IAAkD,GAAA,YAAY,EAC9D,YAAqB,EAAA;AAErB,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;AAED,QAAA,IAAI,IAAI,KAAK,YAAY,IAAI,IAAI,KAAK,YAAY,EAAE;YAClD,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;AAClD,SAAA;AAAM,aAAA;YACL,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACpC,SAAA;KACF;AAEO,IAAA,kBAAkB,CAAC,KAAa,EAAA;AAMtC,QAAA,MAAM,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AAC3C,QAAA,MAAM,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AAC3C,QAAA,MAAM,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AAC3C,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AACtB,YAAA,MAAM,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAC3C,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;AACvB,SAAA;AACD,QAAA,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;KACpB;AAEO,IAAA,iBAAiB,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS,EAAA;QACvD,OAAO,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;KAC3E;AAEO,IAAA,UAAU,CAAC,KAAa,EAAA;AAC9B,QAAA,OAAO,CAAC,GAAG,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;KAC7C;AAEO,IAAA,cAAc,CACpB,MAAc,EACd,MAAc,EACd,aAAqB,EAAA;QAErB,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;QAClD,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;AAClD,QAAA,MAAM,IAAI,GACR,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QACtC,OAAO,IAAI,GAAG,aAAa,CAAC;KAC7B;AACF;;MCxVY,OAAO,CAAA;AA8ElB,IAAA,WAAA,GAAA;QApEO,IAAK,CAAA,KAAA,GAAkB,EAAE,CAAC;QAC1B,IAAW,CAAA,WAAA,GAAa,KAAK,CAAC;;QA+C7B,IAAgB,CAAA,gBAAA,GAAkB,EAAE,CAAC;;QAG5B,IAA6C,CAAA,6CAAA,GAAG,IAAI,CAAC;;QAGrD,IAAW,CAAA,WAAA,GAAW,IAAI,CAAC;QAC3B,IAAU,CAAA,UAAA,GACzB,YAAY,CAAC;QACE,IAAa,CAAA,aAAA,GAAG,GAAG,CAAC;;QAGpB,IAA2B,CAAA,2BAAA,GAAG,SAAS,CAAC;QACxC,IAAoC,CAAA,oCAAA,GAAG,EAAE,CAAC;;QAG1C,IAAkC,CAAA,kCAAA,GAAG,SAAS,CAAC;QAC/C,IAAkC,CAAA,kCAAA,GAAG,WAAW,CAAC;QACjD,IAAuC,CAAA,uCAAA,GAAG,GAAG,CAAC;QAG7D,IAAI,CAAC,aAAa,GAAG;AACnB,YAAA,IAAI,EAAE,EAAE;AACR,YAAA,KAAK,EAAE,CAAC;AACR,YAAA,MAAM,EAAE,CAAC;AACT,YAAA,QAAQ,EAAE,CAAC;AACX,YAAA,qBAAqB,EAAE,CAAC;SACzB,CAAC;KACH;IAED,YAAY,GAAA;AACV,QAAA,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;KAChC;AAED,IAAA,YAAY,CAAC,SAAiB,EAAA;AAC5B,QAAA,IAAI,CAAC,aAAa,CAAC,IAAI,GAAG,SAAS,CAAC;KACrC;AAED,IAAA,gBAAgB,CAAC,KAAa,EAAE,MAAc,EAAE,QAAgB,EAAA;AAC9D,QAAA,IAAI,CAAC,aAAa,CAAC,KAAK,GAAG,KAAK,CAAC;AACjC,QAAA,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,MAAM,CAAC;AACnC,QAAA,IAAI,CAAC,aAAa,CAAC,QAAQ,GAAG,QAAQ,CAAC;KACxC;AAED;;;AAGG;IACH,gBAAgB,GAAA;AACd,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;YAAE,OAAO,CAAC,CAAC,CAAC;AACxC,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;KAC1B;AAED;;;AAGG;IACH,QAAQ,GAAA;AACN,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAAE,YAAA,OAAO,EAAE,CAAC;QACxC,OAAO,IAAI,CAAC,KAAK,CAAC;KACnB;AAED;;;;AAIG;AACH,IAAA,WAAW,CAAC,aAAqB,EAAA;AAC/B,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAAE,YAAA,OAAO,SAAS,CAAC;AAC/C,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE,KAAK,aAAa,CAAC,CAAC;KAC7D;AAED;;;;AAIG;AACH,IAAA,aAAa,CAAC,eAAuB,EAAA;AACnC,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAAE,YAAA,OAAO,SAAS,CAAC;AAC/C,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,eAAe,KAAK,eAAe,CAAC,CAAC;KAC5E;AAED;;AAEG;IACH,QAAQ,CACN,oBAA4B,EAC5B,iBAAqC,EACrC,gBAAoC,EACpC,qBAAyC,EACzC,OAAgB,EAAA;AAEhB,QAAA,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AAC3B,YAAA,IAAI,CAAC,aAAa,CAAC,qBAAqB,GAAG,oBAAoB,CAAC;AACjE,SAAA;AAED,QAAA,IAAI,OAAO,CAAC,aAAa,KAAK,SAAS,EAAE;YACvC,OAAO,CAAC,KAAK,CACX,CAAA,oBAAA,EAAuB,oBAAoB,CAAiC,+BAAA,CAAA,EAC5E,OAAO,CACR,CAAC;YACF,OAAO;AACR,SAAA;AAED,QAAA,MAAM,gCAAgC,GAAW,OAAe,CAAC,EAAE;cAC9D,OAAe,CAAC,EAAE;cACnB,EAAE,CAAC;AACP,QAAA,IAAI,gCAAgC,CAAC,MAAM,KAAK,CAAC,EAAE;YACjD,OAAO,CAAC,KAAK,CACX,CAAA,oBAAA,EAAuB,oBAAoB,CAAsD,oDAAA,CAAA,EACjG,OAAO,CACR,CAAC;YACF,OAAO;AACR,SAAA;QAED,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,gCAAgC,CAAC,CAAC;QAC3E,IAAI,CAAC,UAAU,EAAE;YACf,OAAO,CAAC,IAAI,CACV,CAAA,oBAAA,EAAuB,oBAAoB,CAAmC,iCAAA,CAAA,EAC9E,gCAAgC,CACjC,CAAC;YACF,OAAO;AACR,SAAA;AAED,QAAA,IACE,OAAO,CAAC,iBAAiB,KAAK,SAAS;AACvC,YAAA,OAAO,CAAC,kBAAkB,KAAK,SAAS,EACxC;YACA,OAAO,CAAC,KAAK,CACX,CAAA,oBAAA,EAAuB,oBAAoB,CAAsC,oCAAA,CAAA,EACjF,OAAO,CACR,CAAC;AACH,SAAA;AAAM,aAAA,IAAI,OAAO,CAAC,iBAAiB,KAAK,SAAS,EAAE;YAClD,OAAO,CAAC,KAAK,CACX,CAAA,oBAAA,EAAuB,oBAAoB,CAA2C,yCAAA,CAAA,EACtF,OAAO,CACR,CAAC;AACH,SAAA;AAAM,aAAA,IAAI,OAAO,CAAC,kBAAkB,KAAK,SAAS,EAAE;YACnD,OAAO,CAAC,KAAK,CACX,CAAA,oBAAA,EAAuB,oBAAoB,CAA4C,0CAAA,CAAA,EACvF,OAAO,CACR,CAAC;AACH,SAAA;AAED,QAAA,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CACtC,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,kBAAkB,CAC3B,CAAC;QACF,IAAI,CAAC,UAAU,EAAE;YACf,OAAO,CAAC,IAAI,CACV,CAAA,oBAAA,EAAuB,oBAAoB,CAAmC,iCAAA,CAAA,EAC9E,OAAO,CACR,CAAC;AACH,SAAA;AAED,QAAA,MAAM,IAAI,GAAgB;AACxB,YAAA,EAAE,EAAE,OAAO,CAAC,sBAAsB,CAAC,oBAAoB,CAAC;AACxD,YAAA,eAAe,EAAE,oBAAoB;YACrC,mBAAmB,EAAE,CAAC,CAAC;YACvB,IAAI,EAAE,gCAAgC,CAAC,GAAG,CAAC,CAAC,uBAAuB,KAAI;gBACrE,OAAO;AACL,oBAAA,uBAAuB,CAAC,CAAC;AACzB,oBAAA,uBAAuB,CAAC,CAAC;AACzB,oBAAA,uBAAuB,CAAC,CAAC;AACzB,oBAAA,uBAAuB,CAAC,UAAU;iBACnC,CAAC;AACJ,aAAC,CAAC;YACF,QAAQ,EAAE,OAAO,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC,kBAAkB,KAAI;gBAC9D,OAAO;AACL,oBAAA,kBAAkB,CAAC,CAAC;AACpB,oBAAA,kBAAkB,CAAC,CAAC;AACpB,oBAAA,kBAAkB,CAAC,CAAC;iBACrB,CAAC;AACJ,aAAC,CAAC;YACF,SAAS,EAAE,OAAO,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC,kBAAkB,KAAI;gBAChE,OAAO;AACL,oBAAA,kBAAkB,CAAC,CAAC;AACpB,oBAAA,kBAAkB,CAAC,CAAC;AACpB,oBAAA,kBAAkB,CAAC,CAAC;iBACrB,CAAC;AACJ,aAAC,CAAC;AACF,YAAA,UAAU,EAAE,UAAU;AACtB,YAAA,UAAU,EAAE,UAAU;AACtB,YAAA,iBAAiB,EAAE,iBAAiB;AACpC,YAAA,gBAAgB,EAAE,gBAAgB;AAClC,YAAA,qBAAqB,EAAE,qBAAqB;AAC5C,YAAA,YAAY,EAAE,EAAE;AAChB,YAAA,KAAK,EAAE;AACL,gBAAA,eAAe,EAAE,EAAE;AACpB,aAAA;AACD,YAAA,qBAAqB,EAAE,oBAAoB;YAC3C,yBAAyB,EAAE,CAAC,CAAC;SAC9B,CAAC;AAEF,QAAA,IAAI,QAAQ,CAAC;AACb,QAAA,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE;;AAEhE,YAAA,QAAQ,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AACpE,SAAA;AAAM,aAAA,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;;AAEjC,YAAA,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AAC9C,SAAA;AAED,QAAA,IAAI,QAAQ,EAAE;;AAEZ,YAAA,MAAM,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,CACjD,IAAI,CAAC,UAAU,EACf,QAAQ,CAAC,UAAU,CACpB,CAAC;YAEF,IAAI,iBAAiB,GAAG,IAAI,CAAC;AAC7B,YAAA,IAAI,QAAQ,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,EAAE;AAC1C,gBAAA,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,CAC3C,IAAI,CAAC,UAAU,EACf,QAAQ,CAAC,UAAU,CACpB,CAAC;AACH,aAAA;iBAAM,IAAI,CAAC,QAAQ,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,EAAE;gBAClD,iBAAiB,GAAG,KAAK,CAAC;AAC3B,aAAA;AAED,YAAA,IAAI,CAAC,iBAAiB,IAAI,CAAC,iBAAiB,EAAE;;AAE5C,gBAAA,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;AACzD,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAEjC,QAAA,OAAO,IAAI,CAAC;KACb;AAED;;;;AAIG;IACH,OAAO,sBAAsB,CAAC,KAAoB,EAAA;AAChD,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC;AAAE,YAAA,OAAO,IAAI,CAAC;AACpC,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AACtB,YAAA,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;AACjB,SAAA;;QAGD,MAAM,mBAAmB,GAKrB,EAAE,CAAC;AACP,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrC,YAAA,mBAAmB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,GAAG,KAAK,CAAC,GAAG,CACvD,CAAC,IAAiB,KAAI;gBACpB,OAAO;AACL,oBAAA,cAAc,EAAE,CAAC;AACjB,oBAAA,cAAc,EAAE,CAAC;iBAClB,CAAC;AACJ,aAAC,CACF,CAAC;AACH,SAAA;;AAGD,QAAA,KAAK,IAAI,UAAU,IAAI,KAAK,EAAE;AAC5B,YAAA,IAAI,cAAsB,CAAC;AAE3B,YAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrC,gBAAA,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AACtB,gBAAA,IAAI,IAAI,CAAC,UAAU,IAAI,UAAU,CAAC,UAAU,EAAE;AAC5C,oBAAA,cAAc,GAAG,OAAO,CAAC,iBAAiB,CACxC,IAAI,CAAC,UAAU,EACf,UAAU,CAAC,UAAU,CACtB,CAAC;AACH,iBAAA;AAED,gBAAA,IAAI,cAAc,GAAG,OAAO,CAAC,qBAAqB,CAChD,IAAI,CAAC,UAAU,EACf,UAAU,CAAC,UAAU,CACtB,CAAC;gBAEF,mBAAmB,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,GAAG;oBACnD,cAAc,EAAE,cAAc,IAAI,CAAC;oBACnC,cAAc;iBACf,CAAC;AACH,aAAA;AACF,SAAA;;QAGD,MAAM,yBAAyB,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAiB,KAAI;AAChE,YAAA,OAAO,mBAAmB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,CACrD,CACE,IAAY,EACZ,OAA2D,KACzD;gBACF,OAAO,IAAI,GAAG,OAAO,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,CAAC;aAC/D,EACD,CAAC,CACF,CAAC;AACJ,SAAC,CAAC,CAAC;QACH,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,yBAAyB,CAAC,CAAC;QAC7D,MAAM,kBAAkB,GAAG,yBAAyB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;AAC5E,QAAA,MAAM,YAAY,GAAG,KAAK,CAAC,kBAAkB,CAAC,CAAC;QAC/C,IAAI,CAAC,YAAY,EAAE;YACjB,OAAO,CAAC,IAAI,CACV,CAAkC,gCAAA,CAAA,EAClC,yBAAyB,EACzB,aAAa,EACb,kBAAkB,CACnB,CAAC;AACH,SAAA;AAED,QAAA,OAAO,CAAC,KAAK,CAAC,CAAA,gCAAA,CAAkC,EAAE;AAChD,YAAA,QAAQ,EAAE,YAAY;YACtB,UAAU,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,IAAiB,KAAI;AAC7C,gBAAA,OAAO,IAAI,CAAC,eAAe,KAAK,YAAY,CAAC,eAAe,CAAC;AAC/D,aAAC,CAAC;AACH,SAAA,CAAC,CAAC;AACH,QAAA,OAAO,YAAY,CAAC;KACrB;AAED;;;AAGG;AACH,IAAA,MAAM,QAAQ,CAAC,iBAAA,GAA6B,IAAI,EAAA;AAC9C,QAAA,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE;;YAEpC,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAChE,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;;AAE1B,YAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,OAAO;AACR,SAAA;;AAGD,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YAC9C,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,mBAAmB,KAAK,CAAC,CAAC,EAAE;AAC5C,gBAAA,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,mBAAmB;AAC/B,oBAAA,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC;AACrE,aAAA;YACD,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,yBAAyB,KAAK,CAAC,CAAC,EAAE;AAClD,gBAAA,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,yBAAyB;AACrC,oBAAA,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,mBAAmB,CAAC;AACrC,aAAA;AACF,SAAA;AAED,QAAA,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,mBAAmB,KAAK,CAAC,CAAC,EAAE;AAChE,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,mBAAmB;gBACnD,IAAI,CAAC,aAAa,CAAC,QAAQ;AAC3B,oBAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,eAAe,CAAC;AACrD,SAAA;AACD,QAAA,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,yBAAyB,KAAK,CAAC,CAAC,EAAE;AACtE,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,yBAAyB;AACzD,gBAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,mBAAmB,CAAC;AACzD,SAAA;;AAGD,QAAA,IAAI,iBAAiB,EAAE;YACrB,IAAI,CAAC,qBAAqB,EAAE,CAAC;AAC9B,SAAA;;AAGD,QAAA,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;;AAGnB,QAAA,OAAO,CAAC,KAAK,CAAC,CAAA,+CAAA,CAAiD,CAAC,CAAC;QACjE,IAAI,aAAa,GAQD,SAAS,CAAC;AAC1B,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;AAC7B,YAAA,IAAI,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;AACtC,YAAA,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE;gBAC3B,SAAS;AACV,aAAA;YACD,MAAM,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAEzD,YAAA,MAAM,WAAW,GAAG,MAAM,YAAY,CAAC,cAAc,EAAE,CAAC;YACxD,OAAO,CAAC,KAAK,CACX,CAA+C,6CAAA,CAAA,EAC/C,IAAI,CAAC,eAAe,EACpB,WAAW,CACZ,CAAC;YACF,IAAI,WAAW,KAAK,IAAI;gBAAE,SAAS;AACnC,YAAA,IAAI,WAAW,KAAK,IAAI,CAAC,2BAA2B,EAAE;gBACpD,SAAS;AACV,aAAA;AACD,YAAA,MAAM,OAAO,GAAG,MAAM,YAAY,CAAC,UAAU,CAC3C,WAAW,EACX,IAAI,CAAC,oCAAoC,CAC1C,CAAC;AACF,YAAA,IAAI,CAAC,OAAO;gBAAE,SAAS;YACvB,aAAa,GAAG,OAAO,CAAC;AACxB,YAAA,OAAO,CAAC,KAAK,CACX,6DAA6D,EAC7D,OAAO,CACR,CAAC;YACF,MAAM;AACP,SAAA;;AAGD,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;AAC7B,YAAA,IAAI,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;YACtC,IAAI,CAAC,IAAI,CAAC,iBAAiB,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;gBACrD,SAAS;AACV,aAAA;YAED,OAAO,CAAC,KAAK,CACX,CAAA,wCAAA,CAA0C,EAC1C,IAAI,CAAC,eAAe,CACrB,CAAC;;YAGF,MAAM,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;AAEzD,YAAA,IAAI,aAAa,EAAE;AACjB,gBAAA,MAAM,YAAY,CAAC,IAAI,CACrB,CAAC,EACD,aAAa,CAAC,SAAS,EACvB,aAAa,CAAC,KAAK,EACnB,aAAa,CAAC,SAAS,CACxB,CAAC;AACH,aAAA;AAED,YAAA,MAAM,YAAY,CAAC,YAAY,CAC7B,IAAI,CAAC,kCAAkC,EACvC,IAAI,CAAC,kCAAkC,EACvC,IAAI,CAAC,uCAAuC,CAC7C,CAAC;YAEF,MAAM,YAAY,CAAC,aAAa,CAAC;gBAC/B,KAAK,EAAE,IAAI,CAAC,WAAW;AACxB,aAAA,CAAC,CAAC;YAEH,IAAI,UAAU,GAAG,MAAM,YAAY,CAAC,UAAU,CAC5C,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,UAAU,KAAK,YAAY,IAAI,IAAI,CAAC,UAAU,KAAK,YAAY;kBAChE,IAAI,CAAC,aAAa;kBAClB,SAAS,CACd,CAAC;YACF,IAAI,CAAC,UAAU,EAAE;AACf,gBAAA,OAAO,CAAC,IAAI,CACV,CAAA,kEAAA,CAAoE,CACrE,CAAC;gBACF,SAAS;AACV,aAAA;AACD,YAAA,IAAI,CAAC,iBAAiB,GAAG,UAAU,CAAC;;AAGpC,YAAA,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;YAClC,MAAM,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;AAExD,YAAA,IAAI,aAAa,EAAE;AACjB,gBAAA,MAAM,YAAY,CAAC,IAAI,CACrB,CAAC,EACD,aAAa,CAAC,SAAS,EACvB,aAAa,CAAC,KAAK,EACnB,aAAa,CAAC,SAAS,CACxB,CAAC;AACH,aAAA;YAED,MAAM,YAAY,CAAC,aAAa,CAAC;gBAC/B,KAAK,EAAE,IAAI,CAAC,WAAW;AACxB,aAAA,CAAC,CAAC;YAEH,UAAU,GAAG,MAAM,YAAY,CAAC,UAAU,CACxC,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,UAAU,KAAK,YAAY,IAAI,IAAI,CAAC,UAAU,KAAK,YAAY;kBAChE,IAAI,CAAC,aAAa;kBAClB,SAAS,CACd,CAAC;YACF,IAAI,CAAC,UAAU,EAAE;AACf,gBAAA,OAAO,CAAC,IAAI,CACV,CAAA,yEAAA,CAA2E,CAC5E,CAAC;gBACF,SAAS;AACV,aAAA;AACD,YAAA,IAAI,CAAC,gBAAgB,GAAG,UAAU,CAAC;YAEnC,IAAI,IAAI,CAAC,qBAAqB,EAAE;;AAE9B,gBAAA,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;gBAClC,MAAM,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;gBAE7D,UAAU,GAAG,MAAM,YAAY,CAAC,UAAU,CACxC,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,UAAU,KAAK,YAAY,IAAI,IAAI,CAAC,UAAU,KAAK,YAAY;sBAChE,IAAI,CAAC,aAAa;sBAClB,SAAS,CACd,CAAC;gBACF,IAAI,CAAC,UAAU,EAAE;AACf,oBAAA,OAAO,CAAC,IAAI,CACV,CAAA,uEAAA,CAAyE,CAC1E,CAAC;oBACF,SAAS;AACV,iBAAA;AACD,gBAAA,IAAI,CAAC,qBAAqB,GAAG,UAAU,CAAC;AACzC,aAAA;AACF,SAAA;AAED,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KACzB;AAED;;;;;;AAMG;AACH,IAAA,eAAe,CACb,OAAgB,EAChB,YAAoB,GAAG,EACvB,cAA+C,KAAK,EAAA;;AAGpD,QAAA,IAAI,UAAsB,CAAC;QAC3B,IAAI;YACF,UAAU,GAAG,OAAO,CAAC,aAAa,CAAE,OAAe,CAAC,EAAE,CAAC,CAAC;AACzD,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,KAAK,CAAC,CAAA,0CAAA,CAA4C,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC;AACxE,YAAA,OAAO,EAAE,CAAC;AACX,SAAA;QACD,IAAI,CAAC,UAAU,EAAE;AACf,YAAA,MAAM,+BAA+B,CAAC;AACvC,SAAA;;AAGD,QAAA,IAAI,UAAsB,CAAC;AAC3B,QAAA,IAAI,WAAW,KAAK,KAAK,IAAI,WAAW,KAAK,UAAU,EAAE;AACvD,YAAA,UAAU,GAAG,OAAO,CAAC,aAAa,CAChC,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,kBAAkB,CAC3B,CAAC;AACF,YAAA,IAAI,WAAW,KAAK,UAAU,IAAI,CAAC,UAAU,EAAE;AAC7C,gBAAA,MAAM,+BAA+B,CAAC;AACvC,aAAA;AACF,SAAA;;QAGD,MAAM,KAAK,GAAG,EAAE,CAAC;AACjB,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;YAC7B,IACE,CAAC,WAAW,KAAK,KAAK,IAAI,WAAW,KAAK,UAAU;gBACpD,CAAC,IAAI,CAAC,UAAU,EAChB;gBACA,SAAS;AACV,aAAA;iBAAM,IAAI,WAAW,KAAK,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACzD,SAAS;AACV,aAAA;AAED;;;;AAII;;AAGJ,YAAA,IAAI,cAAsB,CAAC;AAC3B,YAAA,IAAI,UAAU,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjC,cAAc,GAAG,OAAO,CAAC,qBAAqB,CAC5C,IAAI,CAAC,UAAU,EACf,UAAU,CACX,CAAC;AACH,aAAA;;AAGD,YAAA,IAAI,cAAsB,CAAC;AAC3B,YAAA,IAAI,UAAU,IAAI,IAAI,CAAC,UAAU,EAAE;gBACjC,cAAc,GAAG,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;AACzE,aAAA;;AAGD,YAAA,IAAI,UAAkB,EACpB,SAAS,GAAG,KAAK,CAAC;YACpB,IAAI,WAAW,KAAK,KAAK,EAAE;AACzB,gBAAA,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,cAAc,IAAI,CAAC,EAAE,cAAc,IAAI,CAAC,CAAC,CAAC;AAChE,gBAAA,IAAI,SAAS,IAAI,cAAc,IAAI,SAAS,IAAI,cAAc,EAAE;oBAC9D,SAAS,GAAG,IAAI,CAAC;AAClB,iBAAA;AACF,aAAA;iBAAM,IAAI,WAAW,KAAK,UAAU,EAAE;gBACrC,UAAU,GAAG,cAAc,CAAC;gBAC5B,IAAI,SAAS,IAAI,cAAc,EAAE;oBAC/B,SAAS,GAAG,IAAI,CAAC;AAClB,iBAAA;AACF,aAAA;iBAAM,IAAI,WAAW,KAAK,UAAU,EAAE;gBACrC,UAAU,GAAG,cAAc,CAAC;gBAC5B,IAAI,SAAS,IAAI,cAAc,EAAE;oBAC/B,SAAS,GAAG,IAAI,CAAC;AAClB,iBAAA;AACF,aAAA;AAED,YAAA,IAAI,CAAC,SAAS;gBAAE,SAAS;;YAGzB,KAAK,CAAC,IAAI,CAAC;AACT,gBAAA,GAAG,IAAI;AACP,gBAAA,UAAU,EAAE,UAAU;AACtB,gBAAA,kBAAkB,EAAE,cAAc;AAClC,gBAAA,kBAAkB,EAAE,cAAc;AAChB,aAAA,CAAC,CAAC;AACvB,SAAA;AAED,QAAA,OAAO,KAAK,CAAC;KACd;AAED;;;;AAIG;IACH,OAAO,aAAa,CAClB,aAAoD,EAAA;QAEpD,OAAO;AACL,YAAA,sBAAsB,EAAE;AACtB,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AAC7C,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AAC7C,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AAC9C,aAAA;AACD,YAAA,yBAAyB,EAAE;AACzB,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,CAAC;AAChD,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,CAAC;AAChD,gBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;AACzC,oBAAA,aAAa,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,CAAC;AACjD,aAAA;AACD,YAAA,oBAAoB,EAAE;AACpB,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AAC5C,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AAC5C,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AAC7C,aAAA;AACD,YAAA,uBAAuB,EAAE;AACvB,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,CAAC;AAC/C,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,CAAC;AAC/C,gBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;AACxC,oBAAA,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC,CAAC;AAChD,aAAA;SACF,CAAC;KACH;AAED;;;;;AAKG;AACH,IAAA,OAAO,aAAa,CAClB,iBAAwD,EACxD,kBAAyD,EAAA;QAEzD,IACE,CAAC,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;aACnE,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC,CAAC,EACnE;AACA,YAAA,OAAO,SAAS,CAAC;AAClB,SAAA;QAED,OAAO;;YAEL,yBAAyB,EACvB,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;AAClD,iBAAA;YACP,iCAAiC,EAC/B,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;AAClD,iBAAA;;YAEP,+BAA+B,EAC7B,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;AAClD,iBAAA;YACP,uCAAuC,EACrC,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjD,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;AAClD,iBAAA;;YAEP,gCAAgC,EAC9B,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;YACP,wCAAwC,EACtC,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;;YAEP,8BAA8B,EAC5B,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;YACP,sCAAsC,EACpC,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;;YAEP,+BAA+B,EAC7B,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;YACP,uCAAuC,EACrC,kBAAkB,KAAK,SAAS,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC;AACjE,kBAAE,IAAI;AACN,kBAAE;oBACE,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACnD,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,iBAAA;;YAEP,wBAAwB,EACtB,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;AAChD,iBAAA;YACP,gCAAgC,EAC9B,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;AAChD,iBAAA;;YAEP,8BAA8B,EAC5B,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;AAChD,iBAAA;YACP,sCAAsC,EACpC,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;AAChD,iBAAA;;YAEP,+BAA+B,EAC7B,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;YACP,uCAAuC,EACrC,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;;YAEP,6BAA6B,EAC3B,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;YACP,qCAAqC,EACnC,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;;YAEP,8BAA8B,EAC5B,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;YACP,sCAAsC,EACpC,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC;AAC/D,kBAAE,IAAI;AACN,kBAAE;oBACE,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;oBACjD,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,iBAAA;SACR,CAAC;KACH;AAED;;;;;;AAMG;IACH,OAAO,iBAAiB,CACtB,WAAuB,EACvB,WAAuB,EACvB,SAAS,GAAG,GAAG,EAAA;QAEf,IAAI,SAAS,GAAG,KAAK,CAAC;QACtB,MAAM,UAAU,GAAG,OAAO,CAAC,qBAAqB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;QAC3E,IAAI,UAAU,IAAI,SAAS;YAAE,SAAS,GAAG,IAAI,CAAC;;AAI9C,QAAA,OAAO,SAAS,CAAC;KAClB;AAED;;;;;AAKG;AACH,IAAA,OAAO,qBAAqB,CAC1B,WAAuB,EACvB,WAAuB,EAAA;AAEvB,QAAA,MAAM,eAAe,GAAG;AACtB,YAAA,oBAAoB,EAAE,OAAO,CAAC,gBAAgB,CAC5C,WAAW,CAAC,oBAAoB,EAChC,WAAW,CAAC,oBAAoB,CACjC;AACD,YAAA,uBAAuB,EAAE,OAAO,CAAC,gBAAgB,CAC/C,WAAW,CAAC,uBAAuB,EACnC,WAAW,CAAC,uBAAuB,CACpC;AACD,YAAA,sBAAsB,EAAE,OAAO,CAAC,gBAAgB,CAC9C,WAAW,CAAC,sBAAsB,EAClC,WAAW,CAAC,sBAAsB,CACnC;AACD,YAAA,yBAAyB,EAAE,OAAO,CAAC,gBAAgB,CACjD,WAAW,CAAC,yBAAyB,EACrC,WAAW,CAAC,yBAAyB,CACtC;SACF,CAAC;QAEF,MAAM,kBAAkB,GAAG,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,MAAM,CAC9D,CAAC,GAAG,EAAE,KAAK,KAAK,GAAG,GAAG,KAAK,EAC3B,CAAC,CACF,CAAC;QACF,OAAO,kBAAkB,GAAG,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC;KACjE;AAED;;;;;;AAMG;IACH,OAAO,iBAAiB,CACtB,WAAuB,EACvB,WAAuB,EACvB,SAAS,GAAG,IAAI,EAAA;QAEhB,MAAM,UAAU,GAAG,OAAO,CAAC,iBAAiB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;AACvE,QAAA,IAAI,UAAU,KAAK,CAAC,CAAC,EAAE;AACrB,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;QACD,OAAO,UAAU,IAAI,SAAS,CAAC;KAChC;AAED;;;;;AAKG;AACH,IAAA,OAAO,iBAAiB,CACtB,WAAuB,EACvB,WAAuB,EAAA;AAEvB,QAAA,MAAM,wBAAwB,GAC5B,WAAW,CAAC,iCAAiC,KAAK,IAAI;YACtD,WAAW,CAAC,iCAAiC,KAAK,IAAI;AACpD,cAAE,SAAS;AACX,cAAE;;AAEE,gBAAA,yBAAyB,EAAE,OAAO,CAAC,gBAAgB,CACjD,WAAW,CAAC,yBAAyB,EACrC,WAAW,CAAC,yBAAyB,CACtC;AACD,gBAAA,iCAAiC,EAAE,OAAO,CAAC,gBAAgB,CACzD,WAAW,CAAC,iCAAiC,EAC7C,WAAW,CAAC,iCAAiC,CAC9C;;AAED,gBAAA,+BAA+B,EAAE,OAAO,CAAC,gBAAgB,CACvD,WAAW,CAAC,+BAA+B,EAC3C,WAAW,CAAC,+BAA+B,CAC5C;AACD,gBAAA,uCAAuC,EAAE,OAAO,CAAC,gBAAgB,CAC/D,WAAW,CAAC,uCAAuC,EACnD,WAAW,CAAC,uCAAuC,CACpD;;AAED,gBAAA,gCAAgC,EAAE,OAAO,CAAC,gBAAgB,CACxD,WAAW,CAAC,gCAAgC,EAC5C,WAAW,CAAC,gCAAgC,CAC7C;AACD,gBAAA,wCAAwC,EAAE,OAAO,CAAC,gBAAgB,CAChE,WAAW,CAAC,wCAAwC,EACpD,WAAW,CAAC,wCAAwC,CACrD;;AAED,gBAAA,8BAA8B,EAAE,OAAO,CAAC,gBAAgB,CACtD,WAAW,CAAC,8BAA8B,EAC1C,WAAW,CAAC,sCAAsC,CACnD;AACD,gBAAA,sCAAsC,EAAE,OAAO,CAAC,gBAAgB,CAC9D,WAAW,CAAC,sCAAsC,EAClD,WAAW,CAAC,sCAAsC,CACnD;;AAED,gBAAA,+BAA+B,EAAE,OAAO,CAAC,gBAAgB,CACvD,WAAW,CAAC,+BAA+B,EAC3C,WAAW,CAAC,+BAA+B,CAC5C;AACD,gBAAA,uCAAuC,EAAE,OAAO,CAAC,gBAAgB,CAC/D,WAAW,CAAC,uCAAuC,EACnD,WAAW,CAAC,uCAAuC,CACpD;aACF,CAAC;AAER,QAAA,MAAM,uBAAuB,GAC3B,WAAW,CAAC,gCAAgC,KAAK,IAAI;YACrD,WAAW,CAAC,gCAAgC,KAAK,IAAI;AACnD,cAAE,SAAS;AACX,cAAE;;AAEE,gBAAA,wBAAwB,EAAE,OAAO,CAAC,gBAAgB,CAChD,WAAW,CAAC,wBAAwB,EACpC,WAAW,CAAC,wBAAwB,CACrC;AACD,gBAAA,gCAAgC,EAAE,OAAO,CAAC,gBAAgB,CACxD,WAAW,CAAC,gCAAgC,EAC5C,WAAW,CAAC,gCAAgC,CAC7C;;AAED,gBAAA,8BAA8B,EAAE,OAAO,CAAC,gBAAgB,CACtD,WAAW,CAAC,8BAA8B,EAC1C,WAAW,CAAC,8BAA8B,CAC3C;AACD,gBAAA,sCAAsC,EAAE,OAAO,CAAC,gBAAgB,CAC9D,WAAW,CAAC,sCAAsC,EAClD,WAAW,CAAC,sCAAsC,CACnD;;AAED,gBAAA,+BAA+B,EAAE,OAAO,CAAC,gBAAgB,CACvD,WAAW,CAAC,+BAA+B,EAC3C,WAAW,CAAC,+BAA+B,CAC5C;AACD,gBAAA,uCAAuC,EAAE,OAAO,CAAC,gBAAgB,CAC/D,WAAW,CAAC,uCAAuC,EACnD,WAAW,CAAC,uCAAuC,CACpD;;AAED,gBAAA,6BAA6B,EAAE,OAAO,CAAC,gBAAgB,CACrD,WAAW,CAAC,6BAA6B,EACzC,WAAW,CAAC,6BAA6B,CAC1C;AACD,gBAAA,qCAAqC,EAAE,OAAO,CAAC,gBAAgB,CAC7D,WAAW,CAAC,qCAAqC,EACjD,WAAW,CAAC,qCAAqC,CAClD;;AAED,gBAAA,8BAA8B,EAAE,OAAO,CAAC,gBAAgB,CACtD,WAAW,CAAC,8BAA8B,EAC1C,WAAW,CAAC,8BAA8B,CAC3C;AACD,gBAAA,sCAAsC,EAAE,OAAO,CAAC,gBAAgB,CAC9D,WAAW,CAAC,sCAAsC,EAClD,WAAW,CAAC,sCAAsC,CACnD;aACF,CAAC;;QAGR,IAAI,0BAA0B,GAAG,CAAC,CAAC;AACnC,QAAA,IAAI,uBAAuB,EAAE;YAC3B,0BAA0B,GAAG,MAAM,CAAC,MAAM,CACxC,uBAAuB,CACxB,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,KAAK,GAAG,GAAG,KAAK,EAAE,CAAC,CAAC,CAAC;AAC1C,SAAA;;QAGD,IAAI,2BAA2B,GAAG,CAAC,CAAC;AACpC,QAAA,IAAI,wBAAwB,EAAE;YAC5B,2BAA2B,GAAG,MAAM,CAAC,MAAM,CACzC,wBAAwB,CACzB,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,KAAK,GAAG,GAAG,KAAK,EAAE,CAAC,CAAC,CAAC;AAC1C,SAAA;;QAGD,IAAI,wBAAwB,IAAI,uBAAuB,EAAE;AACvD,YAAA,QACE,CAAC,2BAA2B,GAAG,0BAA0B;AACzD,iBAAC,MAAM,CAAC,IAAI,CAAC,wBAAyB,CAAC,CAAC,MAAM;oBAC5C,MAAM,CAAC,IAAI,CAAC,uBAAwB,CAAC,CAAC,MAAM,CAAC,EAC/C;AACH,SAAA;AAAM,aAAA,IAAI,wBAAwB,EAAE;AACnC,YAAA,IACE,WAAW,CAAC,gCAAgC,KAAK,IAAI;AACrD,gBAAA,WAAW,CAAC,gCAAgC,KAAK,IAAI,EACrD;;AAEA,gBAAA,OAAO,CAAC,KAAK,CACX,CAAA,+EAAA,CAAiF,CAClF,CAAC;AACF,gBAAA,QACE,2BAA2B;AAC3B,qBAAC,MAAM,CAAC,IAAI,CAAC,wBAAyB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,EACnD;AACH,aAAA;AACD,YAAA,QACE,2BAA2B;gBAC3B,MAAM,CAAC,IAAI,CAAC,wBAAyB,CAAC,CAAC,MAAM,EAC7C;AACH,SAAA;AAAM,aAAA,IAAI,uBAAuB,EAAE;AAClC,YAAA,IACE,WAAW,CAAC,iCAAiC,KAAK,IAAI;AACtD,gBAAA,WAAW,CAAC,iCAAiC,KAAK,IAAI,EACtD;;AAEA,gBAAA,OAAO,CAAC,KAAK,CACX,CAAA,gFAAA,CAAkF,CACnF,CAAC;AACF,gBAAA,QACE,0BAA0B;AAC1B,qBAAC,MAAM,CAAC,IAAI,CAAC,uBAAwB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,EAClD;AACH,aAAA;AACD,YAAA,QACE,0BAA0B;gBAC1B,MAAM,CAAC,IAAI,CAAC,uBAAwB,CAAC,CAAC,MAAM,EAC5C;AACH,SAAA;QAED,OAAO,CAAC,CAAC,CAAC;KACX;AAED;;;AAGG;AACI,IAAA,MAAM,MAAM,GAAA;AACjB,QAAA,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;QAC1B,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,MAAM,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;QAE/C,MAAM,YAAY,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAElE,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;YAC7B,IAAI,IAAI,CAAC,iBAAiB,EAAE;gBAC1B,IAAI;AACF,oBAAA,MAAM,KAAK,GACT,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC;oBAC/D,MAAM,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACvD,oBAAA,KAAK,CAAC,IAAI,CAAC,CAAA,MAAA,EAAS,IAAI,CAAC,EAAE,CAAA,CAAA,EAAI,YAAY,CAAA,CAAE,EAAE,MAAM,EAAE;AACrD,wBAAA,MAAM,EAAE,IAAI;AACb,qBAAA,CAAC,CAAC;AACJ,iBAAA;AAAC,gBAAA,OAAO,KAAK,EAAE;AACd,oBAAA,OAAO,CAAC,IAAI,CACV,yDAAyD,EACzD,KAAK,CACN,CAAC;AACF,oBAAA,MAAM,KAAK,CAAC;AACb,iBAAA;AACF,aAAA;YACD,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBACzB,IAAI;AACF,oBAAA,MAAM,KAAK,GACT,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC;oBAC9D,MAAM,MAAM,GAAG,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACtD,oBAAA,KAAK,CAAC,IAAI,CAAC,CAAA,KAAA,EAAQ,IAAI,CAAC,EAAE,CAAA,CAAA,EAAI,YAAY,CAAA,CAAE,EAAE,MAAM,EAAE;AACpD,wBAAA,MAAM,EAAE,IAAI;AACb,qBAAA,CAAC,CAAC;AACJ,iBAAA;AAAC,gBAAA,OAAO,KAAK,EAAE;AACd,oBAAA,OAAO,CAAC,IAAI,CACV,yDAAyD,EACzD,KAAK,CACN,CAAC;AACF,oBAAA,MAAM,KAAK,CAAC;AACb,iBAAA;AACF,aAAA;YACD,IAAI,IAAI,CAAC,qBAAqB,EAAE;gBAC9B,IAAI;AACF,oBAAA,MAAM,KAAK,GACT,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC;oBACnE,MAAM,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AAC3D,oBAAA,KAAK,CAAC,IAAI,CAAC,CAAA,KAAA,EAAQ,IAAI,CAAC,EAAE,CAAA,CAAA,EAAI,YAAY,CAAA,CAAE,EAAE,MAAM,EAAE;AACpD,wBAAA,MAAM,EAAE,IAAI;AACb,qBAAA,CAAC,CAAC;AACJ,iBAAA;AAAC,gBAAA,OAAO,KAAK,EAAE;AACd,oBAAA,OAAO,CAAC,IAAI,CACV,8DAA8D,EAC9D,KAAK,CACN,CAAC;AACF,oBAAA,MAAM,KAAK,CAAC;AACb,iBAAA;AACF,aAAA;AACF,SAAA;QAED,OAAO,MAAM,KAAK,CAAC,aAAa,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;KACpD;AAED;;;AAGG;AACI,IAAA,MAAM,OAAO,GAAA;QAClB,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAC9D,YAAA,OAAO,IAAI,CAAC;AAEd,QAAA,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;AACrB,YAAA,MAAM,IAAI,CAAC,QAAQ,EAAE,CAAC;AACvB,SAAA;QAED,IAAI,oBAAoB,GAAG,EAAE,CAAC;QAC9B,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE;AAC7C,YAAA,MAAM,KAAK,GAAW,cAAc,CAAC,GAAkC,CAAC,CAAC;AACzE,YAAA,oBAAoB,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;AACnC,SAAA;AAED,QAAA,MAAM,IAAI,GAAgB;AACxB,YAAA,SAAS,EAAE,yBAAyB;AACpC,YAAA,OAAO,EAAE,CAAC;YACV,KAAK,EAAE,IAAI,CAAC,aAAc;YAC1B,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAiB,KAAqB;;gBAE3D,MAAM,UAAU,GAAG,EAAE,CAAC;AACtB,gBAAA,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,oBAAoB,EAAE;oBAC9C,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAuB,CAAC,CAAC,CAAC;AAC3D,iBAAA;;gBAGD,IAAI,UAAU,GAAoC,SAAS,CAAC;gBAC5D,IAAI,IAAI,CAAC,UAAU,EAAE;oBACnB,UAAU,GAAG,EAAE,CAAC;AAChB,oBAAA,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,oBAAoB,EAAE;wBAC9C,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAuB,CAAC,CAAC,CAAC;AAC3D,qBAAA;AACF,iBAAA;;gBAGD,OAAO;oBACL,EAAE,EAAE,IAAI,CAAC,EAAE;oBACX,CAAC,EAAE,IAAI,CAAC,eAAe;oBACvB,CAAC,EAAE,IAAI,CAAC,mBAAmB;oBAC3B,CAAC,EAAE,IAAI,CAAC,IAAI;oBACZ,CAAC,EAAE,IAAI,CAAC,QAAQ;oBAChB,CAAC,EAAE,IAAI,CAAC,SAAS;AACjB,oBAAA,CAAC,EAAE,UAAU;AACb,oBAAA,CAAC,EAAE,UAAU;oBACb,CAAC,EAAE,IAAI,CAAC,YAAY;oBACpB,EAAE,EAAE,IAAI,CAAC,yBAAyB;oBAClC,EAAE,EAAE,IAAI,CAAC,qBAAqB;iBAC/B,CAAC;AACJ,aAAC,CAAC;AACF,YAAA,qBAAqB,EAAE,oBAAoB;SAC5C,CAAC;AAEF,QAAA,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;KAC7B;AAED;;;AAGG;AACH,IAAA,QAAQ,CAAC,IAAkB,EAAA;AACzB,QAAA,MAAM,UAAU,GAAG,OAAO,IAAI,KAAK,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;AAEtE,QAAA,IAAI,UAAU,CAAC,SAAS,KAAK,yBAAyB,EAAE;AACtD,YAAA,MAAM,SAAS,CAAC;AACjB,SAAA;AAAM,aAAA,IAAI,UAAU,CAAC,OAAO,KAAK,CAAC,EAAE;AACnC,YAAA,MAAM,WAAW,CAAC;AACnB,SAAA;AAED,QAAA,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC,KAAK,CAAC;AACtC,QAAA,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAqB,KAAiB;YACvE,MAAM,UAAU,GAAQ,EAAE,CAAC;YAC3B,OAAO,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,KAAK,KAAI;gBAC9C,UAAU,CAAC,GAAuB,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;AACtD,aAAC,CAAC,CAAC;YAEH,MAAM,UAAU,GAAQ,EAAE,CAAC;YAC3B,IAAI,IAAI,CAAC,CAAC,EAAE;gBACV,OAAO,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,KAAK,KAAI;oBAC9C,UAAU,CAAC,GAAuB,CAAC,GAAG,IAAI,CAAC,CAAE,CAAC,KAAK,CAAC,CAAC;AACvD,iBAAC,CAAC,CAAC;AACJ,aAAA;YAED,OAAO;AACL,gBAAA,EAAE,EACA,IAAI,CAAC,EAAE,KAAK,SAAS;sBACjB,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;sBACtC,IAAI,CAAC,EAAE;gBACb,eAAe,EAAE,IAAI,CAAC,CAAC;gBACvB,mBAAmB,EAAE,IAAI,CAAC,CAAC;gBAC3B,IAAI,EAAE,IAAI,CAAC,CAAC;gBACZ,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAChB,SAAS,EAAE,IAAI,CAAC,CAAC;AACjB,gBAAA,UAAU,EAAE,UAAU;AACtB,gBAAA,UAAU,EAAE,UAAU;AACtB,gBAAA,iBAAiB,EAAE,SAAS;gBAC5B,YAAY,EAAE,IAAI,CAAC,CAAC;AACpB,gBAAA,KAAK,EAAE,SAAS;gBAChB,yBAAyB,EAAE,IAAI,CAAC,EAAE;gBAClC,qBAAqB,EAAE,IAAI,CAAC,EAAE;aAC/B,CAAC;AACJ,SAAC,CAAC,CAAC;KACJ;AAED;;;;AAIG;AACH,IAAA,MAAM,OAAO,CAAC,MAAmB,EAAE,gBAAyB,IAAI,EAAA;AAC9D,QAAA,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAC;AAC1B,QAAA,OAAO,CAAC,KAAK,CAAC,CAAA,iBAAA,CAAmB,CAAC,CAAC;AACnC,QAAA,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;AAC7D,QAAA,IAAI,CAAC,GAAG;AAAE,YAAA,MAAM,oBAAoB,CAAC;AAErC,QAAA,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;QACzD,IAAI,IAAI,KAAK,SAAS,EAAE;AACtB,YAAA,MAAM,8BAA8B,CAAC;AACtC,SAAA;AAED,QAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAEpB,MAAM,OAAO,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAE7D,QAAA,IAAI,aAAa,EAAE;AACjB,YAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;AAC7B,gBAAA,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE;AAC3B,oBAAA,IAAI,WAAmB,CAAC;AACxB,oBAAA,IAAI,GAAG,CAAC,IAAI,CAAC,CAAS,MAAA,EAAA,IAAI,CAAC,EAAE,CAAI,CAAA,EAAA,OAAO,CAAE,CAAA,CAAC,EAAE;wBAC3C,WAAW,GAAG,MAAM,GAAG;6BACpB,IAAI,CAAC,SAAS,IAAI,CAAC,EAAE,CAAI,CAAA,EAAA,OAAO,EAAE,CAAC;AACpC,8BAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;AACrB,qBAAA;AAAM,yBAAA;wBACL,WAAW,GAAG,MAAM,GAAG;6BACpB,IAAI,CAAC,SAAS,IAAI,CAAC,eAAe,CAAI,CAAA,EAAA,OAAO,EAAE,CAAC;AACjD,8BAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;AACrB,qBAAA;AACD,oBAAA,IAAI,WAAW,EAAE;wBACf,IAAI,CAAC,iBAAiB,GAAG,CAAQ,KAAA,EAAA,IAAI,CAAC,UAAU,CAAA,QAAA,EAAW,WAAW,CAAA,CAAE,CAAC;AAC1E,qBAAA;AACF,iBAAA;AACD,gBAAA,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;oBAC1B,MAAM,iBAAiB,GAAG,CAAQ,KAAA,EAAA,IAAI,CAAC,EAAE,CAAA,CAAA,EAAI,OAAO,CAAA,CAAE,CAAC;oBACvD,MAAM,WAAW,GAAG,MAAM,GAAG;yBAC1B,IAAI,CAAC,iBAAiB,CAAC;AACxB,0BAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;AACpB,oBAAA,IAAI,WAAW,EAAE;wBACf,IAAI,CAAC,gBAAgB,GAAG,CAAQ,KAAA,EAAA,IAAI,CAAC,UAAU,CAAA,QAAA,EAAW,WAAW,CAAA,CAAE,CAAC;AACzE,qBAAA;AACF,iBAAA;AACF,aAAA;AACF,SAAA;KACF;AAED,IAAA,OAAO,gBAAgB,CAAC,CAAW,EAAE,CAAW,EAAA;AAC9C,QAAA,IAAIA,uBAAc,EAAE;AAClB,YAAA,OAAOA,uBAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAC7B,SAAA;AACD,QAAA,OAAOC,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;KAC7B;AAEO,IAAA,4BAA4B,CAAC,uBAAgC,EAAA;AACnE,QAAA,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO;AAE/C,QAAA,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,KAAK,CAAC,EAAE;;YAEtC,MAAM,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;AACtC,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACtB,YAAA,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;YAC3B,OAAO;AACR,SAAA;;AAGD,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AACzD,YAAA,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,mBAAmB;gBAC1C,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,eAAe;AAC5C,oBAAA,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC;AAC5C,SAAA;AACD,QAAA,IAAI,uBAAuB,EAAE;AAC3B,YAAA,IAAI,CAAC,gBAAgB,CACnB,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CACjC,CAAC,mBAAmB;gBACnB,uBAAuB;AACvB,oBAAA,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,eAAe,CAAC;AAC3E,SAAA;;QAGD,MAAM,YAAY,GAAG,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;;AAG3E,QAAA,YAAY,CAAC,KAAK,CAAC,eAAe,GAAG,IAAI,CAAC,gBAAgB;AACvD,aAAA,MAAM,CAAC,CAAC,IAAiB,KAAI;AAC5B,YAAA,OAAO,IAAI,CAAC,eAAe,KAAK,YAAY,CAAC,eAAe,CAAC;AAC/D,SAAC,CAAC;AACD,aAAA,GAAG,CAAC,CAAC,IAAiB,KAAI;YACzB,OAAO;gBACL,EAAE,EAAE,IAAI,CAAC,EAAE;gBACX,eAAe,EAAE,IAAI,CAAC,eAAe;gBACrC,mBAAmB,EAAE,IAAI,CAAC,mBAAmB;aAC9C,CAAC;AACJ,SAAC,CAAC,CAAC;;AAGL,QAAA,YAAY,CAAC,qBAAqB;AAChC,YAAA,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC;AAC3C,QAAA,YAAY,CAAC,yBAAyB,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CACnE,CAAC,GAAW,EAAE,IAAiB,KAAI;AACjC,YAAA,OAAO,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC;SACvC,EACD,CAAC,CACF,CAAC;QACF,YAAY,CAAC,EAAE,GAAG,OAAO,CAAC,sBAAsB,CAC9C,YAAY,CAAC,qBAAqB,CACnC,CAAC;;QAGF,IAAI,IAAI,CAAC,6CAA6C,EAAE;AACtD,YAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AAC/B,SAAA;AAAM,aAAA;;YAEL,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC;AAC3C,SAAA;;AAGD,QAAA,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;KAC5B;IAED,qBAAqB,GAAA;;AAEnB,QAAA,MAAM,QAAQ,GAAkB,EAAE,EAChC,YAAY,GAAkB,EAAE,CAAC;AACnC,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;AAC7B,YAAA,IAAI,cAA2B,CAAC;AAChC,YAAA,KAAK,MAAM,YAAY,IAAI,QAAQ,EAAE;AACnC,gBAAA,MAAM,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,CACjD,IAAI,CAAC,UAAU,EACf,YAAY,CAAC,UAAU,CACxB,CAAC;gBACF,MAAM,iBAAiB,GACrB,IAAI,CAAC,UAAU,IAAI,YAAY,CAAC,UAAU;AACxC,sBAAE,OAAO,CAAC,iBAAiB,CACvB,IAAI,CAAC,UAAU,EACf,YAAY,CAAC,UAAU,EACvB,GAAG,CACJ;sBACD,KAAK,CAAC;gBAEZ,IAAI,iBAAiB,IAAI,iBAAiB,EAAE;;oBAE1C,cAAc,GAAG,YAAY,CAAC;oBAC9B,MAAM;AACP,iBAAA;AACF,aAAA;AAED,YAAA,IAAI,cAAc,EAAE;AAClB,gBAAA,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACxB,gBAAA,IAAI,cAAc,CAAC,KAAK,CAAC,eAAe,EAAE;AACxC,oBAAA,cAAc,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC;wBACxC,EAAE,EAAE,IAAI,CAAC,EAAE;wBACX,eAAe,EAAE,IAAI,CAAC,eAAe;wBACrC,mBAAmB,EAAE,IAAI,CAAC,mBAAmB;AAC9C,qBAAA,CAAC,CAAC;AACJ,iBAAA;gBACD,SAAS;AACV,aAAA;AAED,YAAA,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACrB,SAAA;AAED,QAAA,OAAO,CAAC,IAAI,CACV,CAAA,0CAAA,EAA6C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAa,UAAA,EAAA,QAAQ,CAAC,MAAM,QAAQ,EAClG;AACE,YAAA,OAAO,EAAE,YAAY;AACrB,YAAA,MAAM,EAAE,QAAQ;AACjB,SAAA,CACF,CAAC;AACF,QAAA,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;KACvB;IAED,OAAO,sBAAsB,CAAC,eAAuB,EAAA;QACnD,OAAO,IAAI,CAAC,KAAK,CAAC,eAAe,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;KAChD;AAEO,IAAA,sBAAsB,CAAC,UAAkB,EAAA;AAC/C,QAAA,QAAQ,UAAU;AAChB,YAAA,KAAK,WAAW;AACd,gBAAA,OAAO,KAAK,CAAC;AACf,YAAA,KAAK,YAAY;AACf,gBAAA,OAAO,KAAK,CAAC;AACf,YAAA,KAAK,YAAY;AACf,gBAAA,OAAO,MAAM,CAAC;AAChB,YAAA;AACE,gBAAA,OAAO,KAAK,CAAC;AAChB,SAAA;KACF;;AAn+CD;AACuB,OAAA,CAAA,oBAAoB,GAAG;;IAE5C,wBAAwB;IACxB,2BAA2B;;IAE3B,sBAAsB;IACtB,yBAAyB;CAC1B,CAAC;AAEF;AACuB,OAAA,CAAA,oBAAoB,GAAG;;IAE5C,2BAA2B;IAC3B,mCAAmC;;IAEnC,iCAAiC;IACjC,yCAAyC;;IAEzC,kCAAkC;IAClC,0CAA0C;;IAE1C,gCAAgC;IAChC,wCAAwC;;IAExC,iCAAiC;IACjC,yCAAyC;;IAEzC,0BAA0B;IAC1B,kCAAkC;;IAElC,gCAAgC;IAChC,wCAAwC;;IAExC,iCAAiC;IACjC,yCAAyC;;IAEzC,+BAA+B;IAC/B,uCAAuC;;IAEvC,gCAAgC;IAChC,wCAAwC;CACzC;;ACpEH;;AAEG;MAIU,mBAAmB,CAAA;AAC9B,IAAA,WAAA,GAAA,GAAgB;AAEhB,IAAA,IAAI,CAAC,SAAiB,EAAA;AACpB,QAAA,MAAM,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;AAC9B,QAAA,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;AAChC,QAAA,OAAO,OAAO,CAAC;KAChB;IAED,MAAM,cAAc,CAAC,OAAgB,EAAA;AACnC,QAAA,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC,EAAE;AAC/C,YAAA,IAAI,EAAE,kBAAkB;AACzB,SAAA,CAAC,CAAC;QACH,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QAC7C,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AACtC,QAAA,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC;AACb,QAAA,CAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QACpB,CAAC,CAAC,QAAQ,GAAG,CAAA,EAAG,OAAO,CAAC,YAAY,EAAE,CAAA,WAAA,CAAa,CAAC;QACpD,CAAC,CAAC,KAAK,EAAE,CAAC;KACX;IAED,MAAM,aAAa,CAAC,OAAgB,EAAA;AAClC,QAAA,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,MAAM,EAAE,CAAC;QACvC,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;QAChD,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AACtC,QAAA,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC;AACb,QAAA,CAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QACpB,CAAC,CAAC,QAAQ,GAAG,CAAA,EAAG,OAAO,CAAC,YAAY,EAAE,CAAA,UAAA,CAAY,CAAC;QACnD,CAAC,CAAC,KAAK,EAAE,CAAC;KACX;;gHA7BU,mBAAmB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAnB,mBAAA,CAAA,KAAA,GAAA,EAAA,CAAA,qBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,mBAAmB,cAFlB,MAAM,EAAA,CAAA,CAAA;2FAEP,mBAAmB,EAAA,UAAA,EAAA,CAAA;kBAH/B,UAAU;AAAC,YAAA,IAAA,EAAA,CAAA;AACV,oBAAA,UAAU,EAAE,MAAM;AACnB,iBAAA,CAAA;;;ACaD;;;;AAIG;MAEU,oBAAoB,CAAA;AAe/B,IAAA,WAAA,GAAA;AAdO,QAAA,IAAA,CAAA,qBAAqB,GAC1B,IAAI,YAAY,EAAE,CAAC;QAcnB,IAAI,CAAC,IAAI,EAAE,CAAC;KACb;IAEM,yBAAyB,GAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,wBAAwB;YAAE,OAAO;AAC3C,QAAA,OAAO,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,CAAC;KACtD;IAEM,yBAAyB,GAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,wBAAwB;YAAE,OAAO;AAC3C,QAAA,OAAO,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,CAAC;KACtD;IAEM,yBAAyB,GAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,wBAAwB;YAAE,OAAO;AAC3C,QAAA,OAAO,IAAI,CAAC,wBAAwB,CAAC,aAAa,EAAE,CAAC;KACtD;IAEM,MAAM,YAAY,CAAC,KAA2C,EAAA;QACnE,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,OAAO;QAE3B,IAAI,KAAK,YAAY,gBAAgB,EAAE;YACrC,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;gBACvD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;AAC1D,aAAA;YAED,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;gBACvD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;AAC1D,aAAA;YAED,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;gBACvD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;AAC1D,aAAA;AACF,SAAA;aAAM,IAAI,KAAK,YAAY,iBAAiB,EAAE;YAC7C,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;gBAClD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;AACrD,aAAA;YAED,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;gBAClD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;AACrD,aAAA;YAED,IAAI,IAAI,CAAC,wBAAwB,EAAE;gBACjC,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;gBAClD,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;AACrD,aAAA;AACF,SAAA;AAED,QAAA,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;KAC5C;IAEO,IAAI,GAAA;QACV,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,wBAAwB;YAC3B,IAAI,CAAC,wBAAwB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;QAE9D,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,wBAAwB;YAC3B,IAAI,CAAC,wBAAwB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;QAE9D,IAAI,CAAC,wBAAwB,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,wBAAwB;YAC3B,IAAI,CAAC,wBAAwB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;AAE9D,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAAC;AAC3B,YAAA,UAAU,EAAE,CAAC,IAAI,KAAI;gBACnB,OAAO,CAAA,iDAAA,EAAoD,IAAI,CAAA,CAAE,CAAC;aACnE;AACF,SAAA,CAAC,CAAC;AAEH,QAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;AACvB,YAAA,UAAU,EAAE,KAAK;AACjB,YAAA,eAAe,EAAE,CAAC;AAClB,YAAA,eAAe,EAAE,IAAI;AACrB,YAAA,kBAAkB,EAAE,KAAK;AACzB,YAAA,kBAAkB,EAAE,IAAI;AACxB,YAAA,sBAAsB,EAAE,GAAG;AAC3B,YAAA,qBAAqB,EAAE,GAAG;AAC3B,SAAA,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,OAAgB,KAAI;AAC3C,YAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AAC1B,SAAC,CAAC,CAAC;KACJ;AAEO,IAAA,SAAS,CAAC,OAAgB,EAAA;QAChC,IACE,CAAC,IAAI,CAAC,wBAAwB;YAC9B,CAAC,IAAI,CAAC,wBAAwB;YAC9B,CAAC,IAAI,CAAC,QAAQ;YAEd,OAAO;;QAGT,IAAI,aAAa,GAA2B,EAAE,CAAC;QAC/C,IAAI,OAAO,CAAC,aAAa,EAAE;AACzB,YAAA,aAAa,GAAG,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,aAAa,CAAC,CACZ,CAAC;YAC5B,IAAI,CAAC,cAAc,CACjB,aAAa,EACb,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CACnE,CAAC;AACH,SAAA;;AAGD,QAAA,IAAI,CAAC,wBAAwB,CAAC,IAAI,EAAE,CAAC;QACrC,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;;QAGF,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,OAAO,CAAC,KAAK,EACb,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;;QAGF,MAAM,kBAAkB,GACtB,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;;AAGvD,QAAA,IAAI,CAAC,wBAAwB,CAAC,SAAS,GAAG,CAAC,CAAC;AAC5C,QAAA,IAAI,aAAa,EAAE;YACjB,IAAI,OAAO,CAAC,kBAAkB,EAAE;AAC9B,gBAAA,IAAI,CAAC,wBAAwB,CAAC,WAAW,GAAG,OAAO,CAAC;AACpD,gBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,wBAAwB,EAAE;AAC1C,oBAAA;AACE,wBAAA,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC;AACzC,wBAAA,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;AAC9B,qBAAA;AACF,iBAAA,CAAC,CAAC;AACJ,aAAA;YACD,IAAI,OAAO,CAAC,iBAAiB,EAAE;AAC7B,gBAAA,IAAI,CAAC,wBAAwB,CAAC,WAAW,GAAG,OAAO,CAAC;AACpD,gBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,wBAAwB,EAAE;AAC1C,oBAAA;AACE,wBAAA,aAAa,CAAC,cAAc,CAAC,UAAU,CAAC;AACxC,wBAAA,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAC;AAC7B,qBAAA;AACF,iBAAA,CAAC,CAAC;AACJ,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,aAAa,EAAE;AACjB,YAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,aAAa,EACb,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;AACF,YAAA,aAAa,CACX,IAAI,CAAC,wBAAwB,EAC7B,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,aAAa,CAAC,KAAK,CAAC,CAAC,EACvE,EAAE,aAAa,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,gBAAgB,EAAE,CACrE,CAAC;AACF,YAAA,aAAa,CACX,IAAI,CAAC,wBAAwB,EAC7B,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,GAAG,CACrC,CAAC,KAAK,KAAK,aAAa,CAAC,KAAK,CAAC,CAChC,EACD,EAAE,aAAa,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,gBAAgB,EAAE,CACrE,CAAC;AACH,SAAA;;AAGD,QAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,OAAO,CAAC,kBAAkB,EAC1B,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;QACF,aAAa,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,kBAAkB,EAAE;AACvE,YAAA,KAAK,EAAE,OAAO;AACd,YAAA,SAAS,EAAE,gBAAgB;AAC3B,YAAA,SAAS,EAAE,CAAC;AACZ,YAAA,MAAM,EAAE,CAAC,IAAS,KAAI;AACpB,gBAAA,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;aAC7C;AACF,SAAA,CAAC,CAAC;AACH,QAAA,cAAc,CACZ,IAAI,CAAC,wBAAwB,EAC7B,OAAO,CAAC,iBAAiB,EACzB,gBAAgB,EAChB,EAAE,KAAK,EAAE,OAAO,EAAE,CACnB,CAAC;QACF,aAAa,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,iBAAiB,EAAE;AACtE,YAAA,KAAK,EAAE,OAAO;AACd,YAAA,SAAS,EAAE,gBAAgB;AAC3B,YAAA,SAAS,EAAE,CAAC;AACZ,YAAA,MAAM,EAAE,CAAC,IAAS,KAAI;AACpB,gBAAA,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;aAC7C;AACF,SAAA,CAAC,CAAC;;AAGH,QAAA,IAAI,IAAI,CAAC,wBAAwB,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAClE,MAAM,iBAAiB,GAAG,CAAC,CAAC;YAC5B,MAAM,gBAAgB,GAAG,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,CAAC,CAAC;YAElE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;YAEF,IAAI,OAAO,CAAC,kBAAkB,EAAE;gBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAClC,OAAO,CAAC,kBAAkB,EAC1B,OAAO,CAAC,KAAK,CAAC,KAAK,EACnB,OAAO,CAAC,KAAK,CAAC,MAAM,CACrB,CAAC;gBAEF,IAAI,YAAY,GAAG,CAAC,CAAC;AACrB,gBAAA,IAAI,YAAY,GAAG,gBAAgB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,IAAI,CAAC,CAAC;gBAExE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,YAAY,EACZ,YAAY,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,EAC3B,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAC5B,CAAC;AACH,aAAA;YAED,IAAI,OAAO,CAAC,iBAAiB,EAAE;gBAC7B,MAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAClC,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,KAAK,CAAC,KAAK,EACnB,OAAO,CAAC,KAAK,CAAC,MAAM,CACrB,CAAC;AAEF,gBAAA,IAAI,YAAY,GACd,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC;AACpE,gBAAA,IAAI,YAAY,GAAG,gBAAgB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,IAAI,CAAC,CAAC;gBAExE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,IAAI,CAAC,wBAAwB,EAC7B,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,YAAY,EACZ,YAAY,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,EAC3B,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAC5B,CAAC;AACH,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,IAAI,CAAC,wBAAwB,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAClE,MAAM,iBAAiB,GAAG,IAAI,CAAC;YAC/B,MAAM,gBAAgB,GAAG,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,CAAC,CAAC;YAElE,IAAI,OAAO,CAAC,aAAa,EAAE;gBACzB,MAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAClC,OAAO,CAAC,aAAa,EACrB,OAAO,CAAC,KAAK,CAAC,KAAK,EACnB,OAAO,CAAC,KAAK,CAAC,MAAM,CACrB,CAAC;gBAEF,MAAM,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC;gBAC9C,MAAM,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC;AAE/C,gBAAA,IAAI,CAAC,wBAAwB,CAAC,KAAK,GAAG,SAAS,CAAC;AAChD,gBAAA,IAAI,CAAC,wBAAwB,CAAC,MAAM,GAAG,UAAU,CAAC;AAElD,gBAAA,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,SAAS,EAAE,UAAU,CAAC,CAAC;gBAErE,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,OAAO,CAAC,KAAK,EACb,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EACZ,CAAC,EACD,CAAC,EACD,SAAS,EACT,UAAU,CACX,CAAC;AACH,aAAA;AAAM,iBAAA;gBACL,IAAI,CAAC,wBAAwB,CAAC,SAAS,CACrC,CAAC,EACD,CAAC,EACD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EACnC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CACrC,CAAC;AACH,aAAA;AACF,SAAA;;AAGD,QAAA,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC;AAC9B,YAAA,SAAS,EAAE,OAAO;;AAElB,YAAA,iBAAiB,EAAE,kBAAkB;;YAErC,uBAAuB,EACrB,IAAI,CAAC,wBAAwB,CAAC,SAAS,CAAC,WAAW,CAAC;;YAEtD,qBAAqB,EAAE,OAAO,CAAC,aAAa;kBACxC,IAAI,CAAC,wBAAyB,CAAC,SAAS,CAAC,WAAW,CAAC;AACvD,kBAAE,SAAS;AACd,SAAA,CAAC,CAAC;;AAGH,QAAA,IAAI,CAAC,wBAAwB,CAAC,OAAO,EAAE,CAAC;KACzC;IAEO,OAAO,CACb,GAA6B,EAC7B,UAA2D,EAAA;AAE3D,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;AAC1B,QAAA,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;AAClC,YAAA,MAAM,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;AAC1B,YAAA,MAAM,EAAE,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YACxB,IAAI,IAAI,IAAI,EAAE,EAAE;gBACd,IACE,IAAI,CAAC,UAAU;AACf,oBAAA,EAAE,CAAC,UAAU;AACb,qBAAC,IAAI,CAAC,UAAU,GAAG,GAAG,IAAI,EAAE,CAAC,UAAU,GAAG,GAAG,CAAC,EAC9C;oBACA,SAAS;AACV,iBAAA;gBACD,GAAG,CAAC,SAAS,EAAE,CAAC;AAChB,gBAAA,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;AAC1D,gBAAA,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;gBACtD,GAAG,CAAC,MAAM,EAAE,CAAC;AACd,aAAA;AACF,SAAA;KACF;IAEO,cAAc,CACpB,SAAiC,EACjC,QAAkB,EAAA;AAElB,QAAA,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE;AAC9B,YAAA,OAAO,SAAS,CAAC,OAAO,CAAC,CAAC;AAC3B,SAAA;KACF;AAEO,IAAA,kBAAkB,CAAC,SAAgB,EAAE,KAAa,EAAE,MAAc,EAAA;AACxE,QAAA,MAAM,kBAAkB,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;AAC3E,QAAA,MAAM,kBAAkB,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;QAC5E,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,kBAAkB,CAAC,CAAC;AAC7C,QAAA,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,GAAG,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,CAAC;KAC/C;;iHA/XU,oBAAoB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;qHAApB,oBAAoB,EAAA,CAAA,CAAA;2FAApB,oBAAoB,EAAA,UAAA,EAAA,CAAA;kBADhC,UAAU;;;AC1BX;;AAEG;;ACFH;;AAEG;;;;"}